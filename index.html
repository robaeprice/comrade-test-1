<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The fairer way to split costs with friends.">
    <title>Comrade</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body style="margin: 0; padding: 0;">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useCallback, useEffect, useMemo } = React;



// ==================== UTILITY FUNCTIONS ====================

// Helper function to apply weighting to wealth values
const applyWeighting = (wealth, weighting) => {
  if (weighting === 'none') return 1;
  if (weighting === 'gentle') return Math.sqrt(wealth);
  if (weighting === 'strong') return wealth * wealth;
  return wealth; // standard
};

// ==================== END UTILITY FUNCTIONS ====================

// ==================== ICON COMPONENTS ====================

const PersonIcon = ({ size = 20 }) => (
  <svg width={size} height={size} viewBox="0 0 40 40">
    <circle cx="20" cy="20" r="18" fill="#000"/>
    <circle cx="20" cy="16" r="5" fill="white"/>
    <path d="M 10 32 Q 10 24 20 24 Q 30 24 30 32" fill="white"/>
  </svg>
);

const BillIcon = ({ size = 20 }) => (
  <svg width={size} height={size} viewBox="0 0 20 20">
    <rect x="2" y="4" width="16" height="12" fill="none" stroke="#000" strokeWidth="2"/>
    <line x1="2" y1="8" x2="18" y2="8" stroke="#000" strokeWidth="2"/>
    <line x1="2" y1="12" x2="18" y2="12" stroke="#000" strokeWidth="2"/>
  </svg>
);

const HouseIcon = ({ size = 20 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24">
    <path d="M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z" fill="#000"/>
  </svg>
);

const TagIcon = ({ size = 20 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24">
    <path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z" fill="#000"/>
  </svg>
);

const QuestionIcon = ({ size = 20 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24">
    <text x="6" y="19" fontFamily="monospace" fontSize="20" fill="#000" fontWeight="bold">?</text>
  </svg>
);

const ListIcon = ({ size = 20 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24">
    <rect x="4" y="5" width="3" height="3" fill="#000"/>
    <rect x="4" y="10" width="3" height="3" fill="#000"/>
    <rect x="4" y="15" width="3" height="3" fill="#000"/>
    <line x1="9" y1="6.5" x2="20" y2="6.5" stroke="#000" strokeWidth="2"/>
    <line x1="9" y1="11.5" x2="20" y2="11.5" stroke="#000" strokeWidth="2"/>
    <line x1="9" y1="16.5" x2="20" y2="16.5" stroke="#000" strokeWidth="2"/>
  </svg>
);

const ErrorIcon = ({ size = 20 }) => (
  <svg width={size} height={size} viewBox="0 0 24 24">
    <line x1="4" y1="4" x2="20" y2="20" stroke="#000" strokeWidth="3"/>
    <line x1="20" y1="4" x2="4" y2="20" stroke="#000" strokeWidth="3"/>
  </svg>
);

// ==================== END ICON COMPONENTS ====================

const DashedDivider = () => <div className="border-t-2 border-dashed border-gray-400 my-6" />;

const CurrencyDivider = () => (
  <div className="flex items-center gap-4 my-6">
    <div className="flex-1 border-t border-black"></div>
    <span className="text-xs font-bold">$ € £</span>
    <div className="flex-1 border-t border-black"></div>
  </div>
);

const WeightingButtons = ({ value, onChange }) => {
  return (
    <div className="flex justify-center">
      <div className="bg-gray-100 p-2 border-2 border-dotted border-black inline-block">
        <div className="flex flex-wrap gap-2">
          {[
            {value: 'gentle', label: 'LOW'},
            {value: 'standard', label: 'MID'},
            {value: 'strong', label: 'HIGH'},
            {value: 'none', label: 'OFF'}
          ].map(w => (
            <button key={w.value} onClick={() => onChange(w.value)} className={`flex-1 min-w-[100px] p-3 font-bold text-xs border-2 ${value === w.value ? 'bg-black text-white border-black' : w.value === 'none' ? 'bg-gray-200 text-gray-500 border-gray-400' : 'bg-white text-black border-gray-400'}`}>
              {w.label}
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};

const WealthMetricButtons = ({ value, onChange }) => {
  return (
    <div className="flex justify-center">
      <div className="bg-gray-100 p-2 border-2 border-dotted border-black inline-block">
        <div className="flex gap-2">
          {[
            {value: 'salary', label: 'SALARY'},
            {value: 'networth', label: 'NET WORTH'}
          ].map(w => (
            <button key={w.value} onClick={() => onChange(w.value)} className={`min-w-[140px] p-3 font-bold text-xs border-2 ${value === w.value ? 'bg-black text-white border-black' : 'bg-white text-black border-gray-400'}`}>
              {w.label}
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};

const MeasurementButtons = ({ value, onChange }) => {
  return (
    <div className="flex justify-center">
      <div className="bg-gray-100 p-2 border-2 border-dotted border-black inline-block">
        <div className="flex gap-2">
          {[
            {value: 'sqft', label: 'SQ FT'},
            {value: 'sqm', label: 'SQ M'}
          ].map(m => (
            <button key={m.value} onClick={() => onChange(m.value)} className={`min-w-[140px] p-3 font-bold text-xs border-2 ${value === m.value ? 'bg-black text-white border-black' : 'bg-white text-black border-gray-400'}`}>
              {m.label}
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};

const CurrencyButtons = ({ value, onChange }) => {
  return (
    <div className="flex justify-center">
      <div className="bg-gray-100 p-2 border-2 border-dotted border-black inline-block">
        <div className="flex gap-2">
          {[
            {value: 'USD', label: '$'},
            {value: 'EUR', label: '€'},
            {value: 'GBP', label: '£'}
          ].map(c => (
            <button key={c.value} onClick={() => onChange(c.value)} className={`min-w-[100px] p-3 font-bold text-xl border-2 ${value === c.value ? 'bg-black text-white border-black' : 'bg-white text-black border-gray-400'}`}>
              {c.label}
            </button>
          ))}
        </div>
      </div>
    </div>
  );
};

const FormInput = ({ type = 'text', value, onChange, placeholder, className = '', style, ...props }) => {
  const baseClasses = "w-full p-2 border-2 border-gray-400 bg-white text-xs uppercase";
  
  if (type === 'textarea') {
    return (
      <textarea
        value={value}
        onChange={onChange}
        placeholder={placeholder}
        className={`${baseClasses} ${className}`}
        style={style}
        {...props}
      />
    );
  }
  
  return (
    <input
      type={type}
      value={value}
      onChange={onChange}
      placeholder={placeholder}
      className={`${baseClasses} ${className}`}
      style={style}
      {...props}
    />
  );
};

const ItemList = ({ items, onDelete, renderItem }) => {
  if (items.length === 0) return null;
  
  return (
    <div className="mt-4 space-y-2">
      {items.map((item) => (
        <div key={item.id} className="bg-white p-3 border border-black flex justify-between items-center">
          <div className="flex-1">
            {renderItem(item)}
          </div>
          <button onClick={() => onDelete(item.id)} className="text-black font-bold text-xl ml-3 hover:text-gray-600">×</button>
        </div>
      ))}
    </div>
  );
};

const AddItemCard = ({ title, fields, onAdd, items, onDelete, renderItem, addButtonLabel, containerClassName }) => {
  const className = containerClassName !== undefined ? containerClassName : "bg-white p-6 border-2 border-dashed border-gray-400 mb-4";
  
  return (
    <div className={className}>
      {title && <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider border-b-2 border-dashed border-gray-400 pb-2">{title}</h3>}
      <div className="flex flex-wrap gap-2 mb-3">
        {fields.map((field, idx) => (
          field.type === 'select' ? (
            <select
              key={idx}
              value={field.value}
              onChange={field.onChange}
              className="flex-1 p-2 border-2 border-gray-400 bg-white text-xs uppercase"
              style={{ minWidth: field.minWidth || '120px', height: '38px' }}
            >
              <option value="">{field.placeholder}</option>
              {field.options && field.options.map((opt, i) => (
                <option key={i} value={opt.value || opt}>{opt.label || opt}</option>
              ))}
            </select>
          ) : (
            <FormInput
              key={idx}
              type={field.type || 'text'}
              value={field.value}
              onChange={field.onChange}
              placeholder={field.placeholder}
              min={field.min}
              step={field.step}
              inputMode={field.inputMode}
              className="flex-1"
              style={{ minWidth: field.minWidth || '120px' }}
            />
          )
        ))}
      </div>
      <button onClick={onAdd} className="bg-black text-white px-4 py-2 font-bold border-2 border-black text-xs">{addButtonLabel}</button>
      
      <ItemList items={items} onDelete={onDelete} renderItem={renderItem} />
    </div>
  );
};

const ResponsiveDataTable = ({ data, columns, mobileCardConfig }) => {
  return (
    <>
      {/* Desktop Table */}
      <div className="hidden md:block overflow-x-auto">
        <table className="w-full border-collapse border-2 border-black">
          <thead>
            <tr className="bg-gray-200">
              {columns.map((col, idx) => (
                <th key={idx} className="p-3 text-left font-bold text-black border-2 border-black text-xs uppercase">
                  {col.header}
                </th>
              ))}
            </tr>
          </thead>
          <tbody>
            {data.map((item, i) => (
              <tr key={item.id || i} className={i % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                {columns.map((col, colIdx) => (
                  <td key={colIdx} className={`p-3 border border-black text-xs ${col.className || 'text-black'}`}>
                    {col.render(item, i)}
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {/* Mobile Cards */}
      <div className="md:hidden space-y-3">
        {data.map((item, idx) => {
          const cardClassName = typeof mobileCardConfig.cardClassName === 'function' 
            ? mobileCardConfig.cardClassName(item, idx)
            : mobileCardConfig.cardClassName || 'bg-white p-4 border-2 border-gray-400';
          
          return (
            <div key={item.id || idx} className={cardClassName}>
              {mobileCardConfig.titleExtra ? (
                <div className="flex justify-between items-start mb-3 border-b border-dashed border-gray-400 pb-2">
                  <p className="font-bold text-sm text-black uppercase">
                    {mobileCardConfig.getTitle(item, idx)}
                  </p>
                  {mobileCardConfig.titleExtra(item, idx)}
                </div>
              ) : (
                <p className="font-bold text-sm text-black mb-3 uppercase border-b border-dashed border-gray-400 pb-2">
                  {mobileCardConfig.getTitle(item, idx)}
                </p>
              )}
              <div className="space-y-2 text-xs">
                {mobileCardConfig.rows.map((row, rowIdx) => (
                  <div key={rowIdx} className={row.className || 'flex justify-between'}>
                    <span className="text-black font-bold">{row.label}:</span>
                    <span className={row.valueClassName || 'font-semibold text-black'}>{row.getValue(item)}</span>
                  </div>
                ))}
              </div>
            </div>
          );
        })}
      </div>
    </>
  );
};

const Layout = ({ children, onNavigate, showCopyToast }) => {
  return (
    <div style={{fontFamily: 'Sixtyfour, monospace', background: 'linear-gradient(135deg, rgba(255,215,0,0.85) 0%, rgba(255,140,0,0.85) 100%), url("data:image/svg+xml,%3Csvg width=\'75\' height=\'90\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Ctext x=\'10\' y=\'20\' font-family=\'Sixtyfour,monospace\' font-size=\'18\' fill=\'%23ffffff\' font-weight=\'bold\'%3E$%3C/text%3E%3Ctext x=\'35\' y=\'20\' font-family=\'Sixtyfour,monospace\' font-size=\'18\' fill=\'%23ffffff\' font-weight=\'bold\'%3E€%3C/text%3E%3Ctext x=\'60\' y=\'20\' font-family=\'Sixtyfour,monospace\' font-size=\'18\' fill=\'%23ffffff\' font-weight=\'bold\'%3E£%3C/text%3E%3Ctext x=\'3\' y=\'50\' font-family=\'Sixtyfour,monospace\' font-size=\'18\' fill=\'%23ffffff\' font-weight=\'bold\'%3E€%3C/text%3E%3Ctext x=\'28\' y=\'50\' font-family=\'Sixtyfour,monospace\' font-size=\'18\' fill=\'%23ffffff\' font-weight=\'bold\'%3E£%3C/text%3E%3Ctext x=\'53\' y=\'50\' font-family=\'Sixtyfour,monospace\' font-size=\'18\' fill=\'%23ffffff\' font-weight=\'bold\'%3E$%3C/text%3E%3Ctext x=\'17\' y=\'80\' font-family=\'Sixtyfour,monospace\' font-size=\'18\' fill=\'%23ffffff\' font-weight=\'bold\'%3E£%3C/text%3E%3Ctext x=\'42\' y=\'80\' font-family=\'Sixtyfour,monospace\' font-size=\'18\' fill=\'%23ffffff\' font-weight=\'bold\'%3E$%3C/text%3E%3Ctext x=\'67\' y=\'80\' font-family=\'Sixtyfour,monospace\' font-size=\'18\' fill=\'%23ffffff\' font-weight=\'bold\'%3E€%3C/text%3E%3C/svg%3E") #dc143c', minHeight: '100vh'}}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Sixtyfour:wght@400&display=swap');
        
        * {
          font-family: 'Sixtyfour', monospace !important;
        }
        html, body {
          overflow-y: auto !important;
          height: auto !important;
        }
        /* Ensure text stays within containers */
        * {
          word-wrap: break-word;
          overflow-wrap: break-word;
        }
        /* Prevent overflow in containers */
        .receipt-container, .bg-white, [class*="border"] {
          overflow: hidden;
        }
        /* Responsive font sizing for headings */
        h1 {
          font-size: clamp(1.5rem, 5vw, 2.5rem);
        }
        h2 {
          font-size: clamp(1.25rem, 4vw, 1.5rem);
        }
        h3 {
          font-size: clamp(1rem, 3vw, 1.25rem);
        }
        /* Button styling - wrap text, center align, no ellipses, no word breaks */
        button {
          white-space: normal;
          text-align: center;
          word-wrap: break-word;
          overflow-wrap: break-word;
          word-break: keep-all;
          hyphens: none;
          overflow: visible;
          min-height: fit-content;
          display: flex;
          align-items: center;
          justify-content: center;
          line-height: 1.3;
          padding: 0.5rem 1rem;
          margin-left: auto;
          margin-right: auto;
        }
        /* Large button specific styling */
        button.calculate-btn {
          font-size: clamp(1rem, 4vw, 1.25rem);
        }
        /* Receipt container with dashed borders */
        .receipt-container {
          position: relative;
          background: #F3F4F6;
          border-left: 4px solid #000;
          border-right: 4px solid #000;
          border-top: 4px dashed #000;
          border-bottom: 4px dashed #000;
          box-shadow: 0 10px 40px rgba(0,0,0,0.3);
          min-height: calc(100vh - 40px);
        }
        .bg-white {
          background-color: #F3F4F6 !important;
        }
        .bg-gray-50 {
          background-color: #E5E7EB !important;
        }
        /* Currency symbol pattern - hide overflow smoothly */
        .currency-pattern {
          overflow: hidden;
          white-space: nowrap;
          text-align: center;
        }
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        .animate-fadeIn {
          animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes barGrow {
          from {
            width: 0;
          }
        }
        .bar-animate {
          animation: barGrow 0.8s ease-out forwards;
        }
        button:active {
          transform: scale(0.97);
        }
        .bg-white {
          background-color: #F3F4F6 !important;
        }
        .bg-gray-50 {
          background-color: #E5E7EB !important;
        }
      `}</style>
      <div className="max-w-xl mx-auto px-2 sm:px-0 py-5">
        <div className="receipt-container">
          <div className="pt-4 px-6 pb-6">
            <div className="border-t-2 border-dashed border-gray-400 mt-2 mb-4"></div>
            <div className="bg-white mb-4 pb-6 border-b-4 border-black">
              <div className="cursor-pointer text-center" onClick={() => onNavigate('home')}>
                <div className="currency-pattern text-xs font-bold text-black mb-2 uppercase tracking-wider">
                  {'$ € £ $ € £ $ € £ $ € £ $ € £ $ € £ $ € £ $ € £ $ € £ $ € £ $ € £'}
                </div>
                <h1 className="font-black text-black tracking-wider text-4xl">COMRADE</h1>
                <div className="currency-pattern text-xs font-bold text-black mt-2 uppercase tracking-wider">
                  {'$ € £ $ € £ $ € £ $ € £ $ € £ $ € £ $ € £ $ € £ $ € £ $ € £ $ € £'}
                </div>
              </div>
            </div>
            <style>{`
              /* Set page title and meta description for link previews */
              document.title = "COMRADE";
            `}</style>
            {children}
            <CurrencyDivider />
            <div className="text-center mt-4 mb-4 text-black text-xs">
              <span className="cursor-pointer hover:underline font-bold" onClick={() => onNavigate('home')}>HOME</span>
              <span className="mx-3">/</span>
              <span className="cursor-pointer hover:underline font-bold" onClick={() => onNavigate('about')}>ABOUT</span>
              <span className="mx-3">/</span>
              <span className="cursor-pointer hover:underline font-bold" onClick={() => onNavigate('legal')}>LEGAL</span>
            </div>
            <div className="text-center text-xs text-gray-700 pb-12">
              <a href="mailto:hello@comrade.money" className="hover:underline">HELLO@COMRADE.MONEY</a>
            </div>
          </div>
        </div>
      </div>
      
      {showCopyToast && (
        <div className="fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-black text-white px-6 py-3 font-bold z-50 border-2 border-black">
          COPIED TO CLIPBOARD!
        </div>
      )}
    </div>
  );
};

const Comrade = () => {
  // Common className constants for repeated patterns
  const CLS = {
    textXsBlack: "text-xs text-black",
    fontBoldBlackUpper: "font-bold text-black uppercase",
    border2DashedGray: "border-2 border-dashed border-gray-400",
    bgWhiteBorder2Dashed: "bg-white p-8 border-2 border-dashed border-gray-400",
    bgWhiteP4Border2: "bg-white p-4 border-2 border-gray-400",
    bgWhiteP6Border2: "bg-white p-6 border-2 border-gray-400",
    borderDashedGray: "border-b border-dashed border-gray-400",
    textBlackFontBold: "text-black font-bold"
  };

  // Set document title and meta description for link previews
  React.useEffect(() => {
    document.title = "COMRADE";
    
    // Update or create meta description
    let metaDescription = document.querySelector('meta[name="description"]');
    if (!metaDescription) {
      metaDescription = document.createElement('meta');
      metaDescription.name = 'description';
      document.head.appendChild(metaDescription);
    }
    metaDescription.content = 'The fairer way to split costs with friends.';
    
    // Update Open Graph meta tags for better social sharing
    let ogTitle = document.querySelector('meta[property="og:title"]');
    if (!ogTitle) {
      ogTitle = document.createElement('meta');
      ogTitle.setAttribute('property', 'og:title');
      document.head.appendChild(ogTitle);
    }
    ogTitle.content = 'COMRADE';
    
    let ogDescription = document.querySelector('meta[property="og:description"]');
    if (!ogDescription) {
      ogDescription = document.createElement('meta');
      ogDescription.setAttribute('property', 'og:description');
      document.head.appendChild(ogDescription);
    }
    ogDescription.content = 'The fairer way to split costs with friends.';
  }, []);

  // Reusable pie chart for wealth visualization
  const renderWealthPieChart = useCallback((data, formatNumberFn) => {
    const sortedData = [...data].sort((a, b) => b.wealth - a.wealth);
    const totalWealth = sortedData.reduce((sum, p) => sum + p.wealth, 0);
    const colors = ['#000000', '#1F2937', '#475569', '#64748B', '#94A3B8', '#CBD5E1', '#E2E8F0', '#F1F5F9'];
    
    return (
      <div className={CLS.bgWhiteP6Border2}>
        <svg viewBox="0 0 200 200" className="w-full max-w-xs mx-auto">
          {(() => {
            let currentAngle = 0;
            const cx = 100, cy = 100, radius = 70, innerRadius = 30;
            
            return sortedData.map((p, idx) => {
              const percentage = totalWealth > 0 ? (p.wealth / totalWealth) : (1 / sortedData.length);
              const angle = percentage * 360;
              
              const startAngle = currentAngle;
              const endAngle = currentAngle + angle;
              
              const startAngleRad = (startAngle - 90) * Math.PI / 180;
              const endAngleRad = (endAngle - 90) * Math.PI / 180;
              
              const x1 = cx + radius * Math.cos(startAngleRad);
              const y1 = cy + radius * Math.sin(startAngleRad);
              const x2 = cx + radius * Math.cos(endAngleRad);
              const y2 = cy + radius * Math.sin(endAngleRad);
              
              const x3 = cx + innerRadius * Math.cos(endAngleRad);
              const y3 = cy + innerRadius * Math.sin(endAngleRad);
              const x4 = cx + innerRadius * Math.cos(startAngleRad);
              const y4 = cy + innerRadius * Math.sin(startAngleRad);
              
              const largeArc = angle > 180 ? 1 : 0;
              
              const path = `
                M ${x1} ${y1}
                A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2}
                L ${x3} ${y3}
                A ${innerRadius} ${innerRadius} 0 ${largeArc} 0 ${x4} ${y4}
                Z
              `;
              
              currentAngle = endAngle;
              
              return (
                <path
                  key={idx}
                  d={path}
                  fill={colors[idx % colors.length]}
                  stroke="white"
                  strokeWidth="1"
                />
              );
            });
          })()}
        </svg>
        
        <div className="mt-6 space-y-2">
          {sortedData.map((p, idx) => {
            const percentage = totalWealth > 0 ? (p.wealth / totalWealth) * 100 : 100 / sortedData.length;
            
            return (
              <div key={idx} className={`flex flex-wrap items-center gap-x-3 gap-y-1 ${CLS.textXsBlack}`}>
                <div 
                  className="w-4 h-4 border border-gray-400 flex-shrink-0"
                  style={{ backgroundColor: colors[idx % colors.length] }}
                ></div>
                <span className={`${CLS.textBlackFontBold}`}>{p.name}</span>
                <span className="text-black whitespace-nowrap">${formatNumberFn(p.wealth.toFixed(2))}</span>
                <span className={`${CLS.textBlackFontBold} whitespace-nowrap`}>({percentage.toFixed(1)}%)</span>
              </div>
            );
          })}
        </div>
      </div>
    );
  }, [CLS]);
  
  const EXAMPLE_DATA = {
    share: {
      people: [
        {id: 1, name: 'Alex', wealth: '32000'},
        {id: 2, name: 'Jordan', wealth: '180000'},
        {id: 3, name: 'Sam', wealth: '45000'},
        {id: 4, name: 'Morgan', wealth: '95000'}
      ],
      bills: [
        {id: 5, description: 'Ski passes', amount: '1200', paidBy: 'Jordan'},
        {id: 6, description: 'Cabin rental', amount: '2400', paidBy: 'Morgan'},
        {id: 7, description: 'Gas', amount: '110', paidBy: 'Alex'},
        {id: 8, description: 'Groceries', amount: '520', paidBy: 'Jordan'},
        {id: 9, description: 'Gear rental', amount: '805', paidBy: 'Sam'}
      ]
    },
    sale: {
      productName: 'Used Honda Civic',
      numberAvailable: '1',
      buyers: [
        {id: 1, name: 'Riley', wealth: '28000', offer: '4800'},
        {id: 2, name: 'Casey', wealth: '75000', offer: '5200'},
        {id: 3, name: 'Taylor', wealth: '140000', offer: '5500'},
        {id: 4, name: 'Drew', wealth: '220000', offer: '6000'}
      ]
    },
    vote: {
      decision: 'What should the company\'s remote work policy be?',
      options: [
        {id: 1, text: 'Fully remote'},
        {id: 2, text: 'Hybrid'},
        {id: 3, text: '100% in-office'}
      ],
      participants: [
        {id: 5, name: 'Oscar', wealth: '250000', vote: '100% in-office'},
        {id: 6, name: 'Gerry', wealth: '120000', vote: 'Hybrid'},
        {id: 7, name: 'Sarah', wealth: '65000', vote: 'Fully remote'},
        {id: 8, name: 'Simone', wealth: '110000', vote: 'Fully remote'},
        {id: 9, name: 'Thomas', wealth: '85000', vote: 'Hybrid'}
      ]
    },
    rent: {
      totalRent: '3600',
      totalUtilities: '240',
      people: [
        {id: 1, name: 'River', roomSize: '180', wealth: '42000'},
        {id: 2, name: 'Skyler', roomSize: '140', wealth: '125000'},
        {id: 3, name: 'Quinn', roomSize: '160', wealth: '68000'}
      ]
    }
  };

  const BUTTON_STYLES = useMemo(() => ({
    primary: 'bg-black text-white px-6 py-2 font-bold border-2 border-black hover:bg-gray-800 transition-all',
    secondary: 'bg-gray-200 text-black px-6 py-2 font-bold border-2 border-gray-400 hover:bg-gray-300 transition-all',
    danger: 'bg-white text-black px-6 py-2 font-bold border-2 border-black hover:bg-gray-100 transition-all',
    large: 'bg-black text-white px-10 py-4 font-black text-xl border-4 border-black hover:bg-gray-800 transition-all uppercase',
    toggle: 'bg-gray-100 text-black px-6 py-3 font-bold border-2 border-solid border-gray-400 hover:bg-gray-200 transition-all'
  }), []);

  const renderNavButtons = useCallback((buttons) => (
    <div className="flex flex-col gap-3 justify-center">
      {buttons.map(({ label, onClick, variant = 'primary', key }) => (
        <button 
          key={key || label}
          onClick={onClick}
          className={BUTTON_STYLES[variant]}
        >
          {label}
        </button>
      ))}
    </div>
  ), [BUTTON_STYLES]);

  const NoDataWarning = useCallback(() => (
    <div className="bg-white p-6 border-2 border-solid border-black mb-6">
      <div className="flex items-center gap-2 mb-2">
        <ErrorIcon />
        <p className="text-black font-bold">NO DATA ENTERED</p>
      </div>
      <p className="text-black text-xs mt-1">Please go back and enter some information.</p>
    </div>
  ), []);

  const DetailToggleButton = useCallback(({ show, onClick }) => (
    <div className="text-center">
      <button onClick={onClick} className={BUTTON_STYLES.toggle}>
        {show ? '▲ HIDE BREAKDOWN' : '▼ SHOW BREAKDOWN'}
      </button>
    </div>
  ), [BUTTON_STYLES]);

  const renderResultsNavigation = (copyText, entryPage) => (
    <div className="flex flex-col gap-3">
      <button onClick={() => copyToClipboard(copyText)} className={BUTTON_STYLES.primary}>COPY RESULTS</button>
      <button onClick={() => navigateTo(entryPage)} className={BUTTON_STYLES.primary}>EDIT DETAILS</button>
      <button onClick={() => navigateTo('home')} className={BUTTON_STYLES.secondary}>RETURN HOME</button>
    </div>
  );

  const renderResultsFooter = (hasData, copyText, entryPage) => hasData && (
    <>
      <div className="bg-white p-8 border-2 border-dashed border-gray-400">
        {renderResultsNavigation(copyText, entryPage)}
      </div>
      
      <div className="my-4 text-center py-6">
        <MotivationalQuote />
      </div>
      
      <div className="mt-4">
        {renderEmailSignup()}
      </div>
    </>
  );

  const renderEntryIntro = ({ title, description, onLoadExample, clearType }) => (
    <>
      <h2 className="text-2xl font-black mb-4 text-black uppercase tracking-wider border-b-4 border-black pb-2">{title}</h2>
      <p className={`mb-4 text-black leading-relaxed ${CLS.textXsBlack}`}>{description}</p>
      <p className={`${CLS.textXsBlack} text-center mb-6 text-gray-600 border-t border-b ${CLS.borderDashedGray} py-2`}>THIS APP DOES NOT SAVE ANY FINANCIAL INFORMATION</p>
      <div className="flex flex-col gap-3 justify-center mb-4">
        {renderNavButtons([
          { label: 'LOAD EXAMPLE', onClick: onLoadExample, variant: 'secondary' },
          { label: 'CLEAR ALL', onClick: () => handleClearAll(clearType), variant: 'danger' }
        ])}
      </div>
    </>
  );

  const EntryPageWrapper = ({ title, description, type, settingsComponent, children }) => (
    <>
      {renderEntryIntro({ 
        title, 
        description, 
        onLoadExample: () => loadExample(type), 
        clearType: type 
      })}
      <CurrencyDivider />
      {children}
      {settingsComponent}
    </>
  );

  const renderNoDataState = (entryPage) => (
    <>
      <NoDataWarning />
      <div className="flex flex-col gap-3">
        {renderNavButtons([
          { label: 'EDIT DETAILS', onClick: () => navigateTo(entryPage), variant: 'primary' },
          { label: 'RETURN HOME', onClick: () => navigateTo('home'), variant: 'secondary' }
        ])}
      </div>
    </>
  );

  const renderEmailSignup = () => (
    <div className={CLS.bgWhiteBorder2Dashed}>
      <h3 className={`text-lg ${CLS.textBlackFontBold} uppercase tracking-wider text-center mb-2`}>LIKE COMRADE?</h3>
      <p className={`${CLS.textXsBlack} text-center mb-4`}>Get updates and news from the team.</p>
      
      {signupStatus === 'success' ? (
        <div className="bg-black text-white p-4 text-center font-bold border-2 border-black">
          THANKS FOR SIGNING UP!
        </div>
      ) : signupStatus === 'error' ? (
        <div className="bg-white text-black p-4 text-center font-bold border-2 border-black">
          ERROR - PLEASE TRY AGAIN
        </div>
      ) : (
        <form onSubmit={handleEmailSignup}>
          <div className="flex flex-col sm:flex-row gap-2 max-w-md mx-auto">
            <FormInput
              type="email"
              value={signupEmail}
              onChange={(e) => setSignupEmail(e.target.value)}
              placeholder="YOUR EMAIL"
              required
              className="flex-1"
            />
            <button 
              type="submit"
              className="bg-black text-white px-6 py-2 font-bold border-2 border-black hover:bg-gray-800 transition-all whitespace-nowrap"
            >
              + SIGN UP
            </button>
          </div>
        </form>
      )}
    </div>
  );

  const renderSettingsPanel = (weighting, setWeighting, showSettings, setShowSettings, resultsPage, currency, setCurrency, wealthMetric, setWealthMetric, measurement, setMeasurement) => (
    <div className="bg-white p-8 border-2 border-dashed border-gray-400 mb-4">
      {!showSettings ? (
        <div className="text-center">
          <button onClick={() => setShowSettings(true)} className={BUTTON_STYLES.toggle}>
            ▼ SHOW SETTINGS
          </button>
        </div>
      ) : (
        <div className="animate-fadeIn">
          <div className="text-center mb-6">
            <button onClick={() => setShowSettings(false)} className={BUTTON_STYLES.toggle}>
              ▲ HIDE SETTINGS
            </button>
          </div>
          
          <DashedDivider />

          <div className="mb-6">
            <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">CURRENCY</h3>
            <p className="text-xs mb-3 text-black">Choose your preferred currency.</p>
            <CurrencyButtons value={currency} onChange={setCurrency} />
          </div>

          <DashedDivider />

          {measurement !== undefined && setMeasurement !== undefined && (
            <>
              <div className="mb-6">
                <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">MEASUREMENTS</h3>
                <p className="text-xs mb-3 text-black">Pick what unit room size should be measured in.</p>
                <MeasurementButtons value={measurement} onChange={setMeasurement} />
              </div>

              <DashedDivider />
            </>
          )}

          <div className="mb-6">
            <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">WEALTH</h3>
            <p className="text-xs mb-3 text-black">Select your preferred financial metric of wealth.</p>
            <WealthMetricButtons value={wealthMetric} onChange={setWealthMetric} />
          </div>

          <DashedDivider />

          <div>
            <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">WEIGHTING</h3>
            <p className="text-xs mb-3 text-black">Decide how much wealth should affect Comrade's calculations. (For a detailed explanation of weighting, <span className="underline cursor-pointer hover:text-gray-600" onClick={() => navigateTo('about')}>read our FAQ</span>. If in doubt, choose Mid.)</p>
            <WeightingButtons value={weighting} onChange={setWeighting} />
          </div>
          
          <DashedDivider />
        </div>
      )}
      
      <div className="text-center mt-4">
        <button onClick={() => navigateTo(resultsPage)} className={`${BUTTON_STYLES.large} calculate-btn`}>CALCULATE</button>
      </div>
    </div>
  );

  const renderBarVisualization = (title, data, bars, getItemName) => (
    <div className="mb-6">
      <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">{title}</h3>
      <div className="space-y-3">
        {data.map((item, idx) => {
          const maxValue = Math.max(...data.map(d => Math.max(...bars.map(b => b.getValue(d)))));
          return (
            <div key={item.id || idx} className="mb-4">
              <p className="font-bold text-black mb-1 text-xs uppercase">{getItemName(item)}</p>
              <div className="space-y-1">
                {bars.map((bar, barIdx) => {
                  const value = bar.getValue(item);
                  const width = maxValue > 0 ? (value / maxValue) * 100 : 0;
                  return (
                    <div key={barIdx} className="flex items-center gap-2">
                      {bar.label && <span className="text-xs text-black w-20 font-bold">{bar.label}:</span>}
                      <div className="flex-1 bg-gray-200 h-6 relative overflow-hidden border border-gray-400">
                        <div 
                          className="h-6 transition-all duration-300 bar-animate flex items-center justify-end pr-2 bg-black"
                          style={{
                            width: `${width}%`,
                            animationDelay: `${idx * 0.1 + barIdx * 0.05}s`
                          }}
                        >
                          {width > 15 && <span className="text-xs font-bold text-white">{bar.displayValue(item)}</span>}
                        </div>
                      </div>
                      <span className="text-xs font-bold text-black w-24 text-right">{bar.rightLabel(item, idx)}</span>
                    </div>
                  );
                })}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );

  const renderDistributionList = (title, data, getItemName, getValue, getValueDisplay) => {
    const totalValue = data.reduce((sum, item) => sum + getValue(item), 0);
    
    return (
      <div className="mb-6">
        <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">{title}</h3>
        <div className="space-y-2">
          {data.map((item, i) => {
            const value = getValue(item);
            const percentage = totalValue > 0 ? (value / totalValue) * 100 : 100 / data.length;
            return (
              <div 
                key={item.id || i}
                className="flex items-center justify-between p-2 border border-gray-300"
              >
                <span className="text-xs text-black font-bold flex-1">
                  {getItemName(item)}
                </span>
                <span className="text-xs text-black mx-2">{getValueDisplay(item)}</span>
                <span className="text-xs text-black font-bold">{percentage < 0.01 ? percentage.toExponential(2) : percentage.toFixed(1)}%</span>
              </div>
            );
          })}
        </div>
      </div>
    );
  };

  const renderEntryButtons = (onLoadExample, onClearAll, resultsPage) => (
    <div className="text-center space-y-3">
      <div className="flex flex-col gap-3 justify-center">
        {renderNavButtons([
          { label: 'LOAD EXAMPLE', onClick: onLoadExample, variant: 'secondary' },
          { label: 'CLEAR ALL', onClick: onClearAll, variant: 'danger' }
        ])}
      </div>
      <button onClick={() => navigateTo(resultsPage)} className={`${BUTTON_STYLES.large} calculate-btn`}>CALCULATE</button>
    </div>
  );

  const renderStatsRow = (stats) => (
    <div className="bg-white p-4 border-2 border-solid border-black mb-4 flex flex-wrap justify-around gap-4">
      {stats.map(({ label, value }, i) => (
        <div key={label} className="text-center">
          <p className="text-xs text-gray-600 uppercase tracking-wider">{label}</p>
          <p className="text-lg font-bold text-black">{value}</p>
        </div>
      ))}
    </div>
  );

  const [page, setPage] = useState('home');
  const [sharePeople, setSharePeople] = useState([]);
  const [shareBills, setShareBills] = useState([]);
  const [currentPersonName, setCurrentPersonName] = useState('');
  const [currentPersonWealth, setCurrentPersonWealth] = useState('');
  const [currentBillDescription, setCurrentBillDescription] = useState('');
  const [currentBillAmount, setCurrentBillAmount] = useState('');
  const [currentBillPaidBy, setCurrentBillPaidBy] = useState('');
  const [shareWeighting, setShareWeighting] = useState('standard');
  const [shareCurrency, setShareCurrency] = useState('USD');
  const [shareWealthMetric, setShareWealthMetric] = useState('salary');
  const [productName, setProductName] = useState('');
  const [numberAvailable, setNumberAvailable] = useState('');
  const [saleBuyers, setSaleBuyers] = useState([]);
  const [currentBuyerName, setCurrentBuyerName] = useState('');
  const [currentBuyerWealth, setCurrentBuyerWealth] = useState('');
  const [currentBuyerOffer, setCurrentBuyerOffer] = useState('');
  const [saleWeighting, setSaleWeighting] = useState('standard');
  const [saleCurrency, setSaleCurrency] = useState('USD');
  const [saleWealthMetric, setSaleWealthMetric] = useState('salary');
  const [voteDecision, setVoteDecision] = useState('');
  const [voteOptions, setVoteOptions] = useState([]);
  const [currentOptionText, setCurrentOptionText] = useState('');
  const [voteParticipants, setVoteParticipants] = useState([]);
  const [currentParticipantName, setCurrentParticipantName] = useState('');
  const [currentParticipantWealth, setCurrentParticipantWealth] = useState('');
  const [currentParticipantVote, setCurrentParticipantVote] = useState('');
  const [voteWeighting, setVoteWeighting] = useState('standard');
  const [voteCurrency, setVoteCurrency] = useState('USD');
  const [voteWealthMetric, setVoteWealthMetric] = useState('salary');
  const [totalRent, setTotalRent] = useState('');
  const [totalUtilities, setTotalUtilities] = useState('');
  const [rentPeople, setRentPeople] = useState([]);
  const [currentRoommateName, setCurrentRoommateName] = useState('');
  const [currentRoommateRoomSize, setCurrentRoommateRoomSize] = useState('');
  const [currentRoommateWealth, setCurrentRoommateWealth] = useState('');
  const [rentWeighting, setRentWeighting] = useState('standard');
  const [rentCurrency, setRentCurrency] = useState('USD');
  const [rentWealthMetric, setRentWealthMetric] = useState('salary');
  const [rentMeasurement, setRentMeasurement] = useState('sqft');
  const [showCopyToast, setShowCopyToast] = useState(false);
  const [showShareDetails, setShowShareDetails] = useState(false);
  const [showVoteDetails, setShowVoteDetails] = useState(false);
  const [showSaleDetails, setShowSaleDetails] = useState(false);
  const [showRentDetails, setShowRentDetails] = useState(false);
  const [randomQuote, setRandomQuote] = useState('');
  const [lastQuoteIndex, setLastQuoteIndex] = useState(-1);
  const [signupEmail, setSignupEmail] = useState('');
  const [signupStatus, setSignupStatus] = useState(''); // '', 'success', 'error'
  const [showShareSettings, setShowShareSettings] = useState(false);
  const [showSaleSettings, setShowSaleSettings] = useState(false);
  const [showVoteSettings, setShowVoteSettings] = useState(false);
  const [showRentSettings, setShowRentSettings] = useState(false);

  const quotes = useMemo(() => ['JEDER NACH SEINEN FÄHIGKEITEN, JEDEM NACH SEINEN BEDÜRFNISSEN', 'THANKS FOR SHARING', 'SHARE AND SHARE ALIKE', 'MANY HANDS MAKE LIGHT WORK', 'ALL FOR ONE AND ONE FOR ALL', 'A RISING TIDE LIFTS ALL BOATS', 'FAIR\'S FAIR', 'LIBERTÉ, ÉGALITÉ, FRATERNITÉ', 'WE\'RE ALL IN THIS TOGETHER', 'WHAT GOES AROUND COMES AROUND', 'NO ONE LEFT BEHIND', 'YOU GET WHAT YOU GIVE', 'WHICH SIDE ARE YOU ON?', 'SHARE THE LOAD', 'BREAD AND ROSES', 'ALL TOGETHER NOW', 'A COMMON TREASURY OF RELIEF FOR ALL, BOTH BEASTS AND MEN', 'WHEN ADAM DELVED AND EVE SPAN, WHO WAS THEN THE GENTLEMAN?', 'E PLURIBUS UNUM', 'WHO BUILT THEBES OF THE SEVEN GATES?', 'SO THE LAST SHALL BE FIRST, AND THE FIRST LAST', 'THE WISDOM OF THE CROWD', 'AND ALL THAT BELIEVED WERE TOGETHER, AND HAD ALL THINGS IN COMMON', 'SALUS POPULI SUPREMA LEX', 'WHAT\'S MINE IS YOURS, AND WHAT IS YOURS IS MINE', 'GIVE US THIS DAY OUR DAILY BREAD', 'NO MAN IS AN ISLAND', 'VIVE LA COMMUNE', 'FOR WHAT SHALL IT PROFIT A MAN, IF HE SHALL GAIN THE WORLD, AND LOSE HIS OWN SOUL?', 'REND DOWN THE HEDGES', 'AM I MY BROTHER\'S KEEPER?', 'IT TAKES A VILLAGE', 'ONE HAND WASHES THE OTHER', 'I DON\'T WANT YOUR MILLIONS, MISTER'], []);

  useEffect(() => {
    window.scrollTo({ top: 0, behavior: 'instant' });
    setShowShareDetails(false);
    setShowVoteDetails(false);
    setShowSaleDetails(false);
    setShowRentDetails(false);
    
    // Select random quote when navigating to any results page
    if (page === 'share-results' || page === 'sale-results' || page === 'vote-results' || page === 'rent-results') {
      // Generate random quote directly to avoid dependency issues
      setLastQuoteIndex(prev => {
        let newIndex;
        do {
          newIndex = Math.floor(Math.random() * quotes.length);
        } while (newIndex === prev && quotes.length > 1);
        
        setRandomQuote(quotes[newIndex]);
        return newIndex;
      });
    }
  }, [page, quotes]);

  useEffect(() => {
    if (showCopyToast) {
      const timer = setTimeout(() => setShowCopyToast(false), 2500);
      return () => clearTimeout(timer);
    }
  }, [showCopyToast]);

  const formatNumber = useCallback((num) => num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","), []);
  const formatSmartNumber = useCallback((num) => {
    if (Math.abs(num) < 0.01 && num !== 0) return num.toExponential(4);
    return formatNumber(num.toFixed(2));
  }, [formatNumber]);

  const getCurrencySymbol = useCallback((currency) => {
    const symbols = { USD: '$', EUR: '€', GBP: '£' };
    return symbols[currency] || '$';
  }, []);

  // Currency formatting helpers
  const formatCurrency = useCallback((value, decimals = 2, currency = 'USD') => 
    `${getCurrencySymbol(currency)}${formatNumber((parseFloat(value) || 0).toFixed(decimals))}`, 
    [formatNumber, getCurrencySymbol]
  );
  const formatCurrencySmart = useCallback((value, currency = 'USD') => 
    `${getCurrencySymbol(currency)}${formatSmartNumber(value)}`, 
    [formatSmartNumber, getCurrencySymbol]
  );

  const getWeightingLabel = useCallback((weighting) => {
    const labels = { none: 'OFF', gentle: 'LOW', standard: 'MID', strong: 'HIGH' };
    return labels[weighting] || 'MID';
  }, []);

  const getWealthMetricLabel = useCallback((metric) => {
    return metric === 'networth' ? 'NET WORTH' : 'SALARY';
  }, []);

  const getMeasurementLabel = useCallback((measurement) => {
    return measurement === 'sqm' ? 'SQ M' : 'SQ FT';
  }, []);

  const copyToClipboard = useCallback((text) => {
    navigator.clipboard.writeText(text);
    setShowCopyToast(true);
  }, []);

  const navigateTo = useCallback((newPage) => {
    setPage(newPage);
  }, []);

  const handleClearAll = useCallback((type) => {
    switch(type) {
      case 'share':
        setSharePeople([]);
        setShareBills([]);
        setCurrentPersonName('');
        setCurrentPersonWealth('');
        setCurrentBillDescription('');
        setCurrentBillAmount('');
        setCurrentBillPaidBy('');
        break;
      case 'sale':
        setProductName('');
        setNumberAvailable('');
        setSaleBuyers([]);
        setCurrentBuyerName('');
        setCurrentBuyerWealth('');
        setCurrentBuyerOffer('');
        break;
      case 'vote':
        setVoteDecision('');
        setVoteOptions([]);
        setVoteParticipants([]);
        setCurrentParticipantName('');
        setCurrentParticipantWealth('');
        setCurrentParticipantVote('');
        setCurrentOptionText('');
        break;
      case 'rent':
        setTotalRent('');
        setTotalUtilities('');
        setRentPeople([]);
        setCurrentRoommateName('');
        setCurrentRoommateRoomSize('');
        setCurrentRoommateWealth('');
        break;
    }
    setTimeout(() => window.scrollTo({ top: 0, behavior: 'smooth' }), 0);
  }, []);

  const loadExample = useCallback((type) => {
    const data = EXAMPLE_DATA[type];
    const baseId = Date.now();
    
    switch(type) {
      case 'share':
        setSharePeople(data.people.map((p, i) => ({...p, id: baseId + i})));
        setShareBills(data.bills.map((b, i) => ({...b, id: baseId + 100 + i})));
        setCurrentPersonName('');
        setCurrentPersonWealth('');
        setCurrentBillDescription('');
        setCurrentBillAmount('');
        setCurrentBillPaidBy('');
        break;
      case 'sale':
        setProductName(data.productName);
        setNumberAvailable(data.numberAvailable);
        setSaleBuyers(data.buyers.map((b, i) => ({...b, id: baseId + i})));
        setCurrentBuyerName('');
        setCurrentBuyerWealth('');
        setCurrentBuyerOffer('');
        break;
      case 'vote':
        setVoteDecision(data.decision);
        setVoteOptions(data.options.map((o, i) => ({...o, id: baseId + i})));
        setVoteParticipants(data.participants.map((p, i) => ({...p, id: baseId + 100 + i})));
        setCurrentParticipantName('');
        setCurrentParticipantWealth('');
        setCurrentParticipantVote('');
        setCurrentOptionText('');
        break;
      case 'rent':
        setTotalRent(data.totalRent);
        setTotalUtilities(data.totalUtilities);
        setRentPeople(data.people.map((p, i) => ({...p, id: baseId + i})));
        setCurrentRoommateName('');
        setCurrentRoommateRoomSize('');
        setCurrentRoommateWealth('');
        break;
    }
    setTimeout(() => window.scrollTo({ top: 0, behavior: 'smooth' }), 0);
  }, [EXAMPLE_DATA]);

  const handleEmailSignup = useCallback(async (e) => {
    e.preventDefault();
    
    // Google Apps Script URL
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxgJDAAOvTIE9Jh3dbYfIu2CBWpUiiwbRuVEPbxRlbGufF1RNL5ZWxen9Noza_eyMHu/exec';
    
    try {
      // Use iframe to trigger the request (most reliable for cross-origin)
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.src = `${SCRIPT_URL}?email=${encodeURIComponent(signupEmail)}`;
      document.body.appendChild(iframe);
      
      // Remove iframe after a moment
      setTimeout(() => {
        document.body.removeChild(iframe);
      }, 2000);
      
      // Show success message
      setSignupStatus('success');
      setSignupEmail('');
      
      // Reset status after 5 seconds
      setTimeout(() => {
        setSignupStatus('');
      }, 5000);
    } catch (error) {
      console.error('Signup error:', error);
      setSignupStatus('error');
      
      // Reset error after 5 seconds
      setTimeout(() => {
        setSignupStatus('');
      }, 5000);
    }
  }, [signupEmail]);

  const MotivationalQuote = useCallback(() => (
    <p className="text-center text-gray-700 leading-relaxed text-xs">
      {randomQuote}
    </p>
  ), [randomQuote]);

  const shareCalculations = useMemo(() => {
    if (page !== 'share-results' || sharePeople.length === 0) return { total: 0, peopleData: [], transactions: [] };
    
    const total = shareBills.reduce((sum, b) => sum + (parseFloat(b.amount) || 0), 0);
    
    const peopleData = sharePeople.map(person => {
      const wealth = parseFloat(person.wealth) || 0;
      const paid = shareBills
        .filter(b => b.paidBy === person.name)
        .reduce((sum, b) => sum + (parseFloat(b.amount) || 0), 0);
      const adjustedWealth = applyWeighting(wealth, shareWeighting);
      
      const totalAdjustedWealth = sharePeople.reduce(
        (sum, p) => sum + applyWeighting(parseFloat(p.wealth) || 0, shareWeighting), 
        0
      );
      const fairShare = totalAdjustedWealth > 0 
        ? (adjustedWealth / totalAdjustedWealth) * total 
        : total / sharePeople.length;
      
      return { 
        ...person, 
        wealth, 
        paid, 
        fairShare, 
        adjustedWealth, 
        paidPct: total > 0 ? (paid / total) * 100 : 0, 
        fairPct: total > 0 ? (fairShare / total) * 100 : 0 
      };
    });

    const settlements = peopleData
      .map(p => ({name: p.name, balance: p.paid - p.fairShare}))
      .filter(s => Math.abs(s.balance) > 0.01);
    
    const payers = settlements.filter(s => s.balance < 0).sort((a, b) => a.balance - b.balance);
    const receivers = settlements.filter(s => s.balance > 0).sort((a, b) => b.balance - a.balance);
    
    const transactions = [];
    let payersIdx = 0, receiversIdx = 0;
    const payersCopy = payers.map(p => ({...p}));
    const receiversCopy = receivers.map(r => ({...r}));
    
    while (payersIdx < payersCopy.length && receiversIdx < receiversCopy.length) {
      const amount = Math.min(-payersCopy[payersIdx].balance, receiversCopy[receiversIdx].balance);
      transactions.push({
        from: payersCopy[payersIdx].name, 
        to: receiversCopy[receiversIdx].name, 
        amount
      });
      payersCopy[payersIdx].balance += amount;
      receiversCopy[receiversIdx].balance -= amount;
      if (Math.abs(payersCopy[payersIdx].balance) < 0.01) payersIdx++;
      if (Math.abs(receiversCopy[receiversIdx].balance) < 0.01) receiversIdx++;
    }

    return { total, peopleData, transactions };
  }, [sharePeople, shareBills, shareWeighting, page]);

  const saleCalculations = useMemo(() => {
    if (page !== 'sale-results' || saleBuyers.length === 0) return { rankedBuyers: [], totalOffers: 0, avgOffer: 0 };
    
    const rankedBuyers = saleBuyers.map(buyer => {
      const wealth = parseFloat(buyer.wealth) || 1;
      const offer = parseFloat(buyer.offer) || 0;
      const adjustedWealth = applyWeighting(wealth, saleWeighting);
      const needScore = (offer / adjustedWealth) * 100;
      return { ...buyer, wealth, offer, needScore, adjustedWealth };
    }).sort((a, b) => b.needScore - a.needScore);

    const totalOffers = rankedBuyers.reduce((sum, b) => sum + b.offer, 0);
    const avgOffer = rankedBuyers.length > 0 ? totalOffers / rankedBuyers.length : 0;

    return { rankedBuyers, totalOffers, avgOffer };
  }, [saleBuyers, saleWeighting, page]);

  const voteCalculations = useMemo(() => {
    if (page !== 'vote-results' || voteParticipants.length === 0) return { participantsData: [], totalVotingPower: 0, voteBreakdown: [], options: [] };
    
    const options = voteOptions.map(o => o.text);
    const totalWealth = voteParticipants.reduce((sum, p) => sum + (parseFloat(p.wealth) || 0), 0);
    const avgWealth = totalWealth / voteParticipants.length;
    
    const participantsData = voteParticipants.map(p => {
      const wealth = parseFloat(p.wealth) || 0;
      const adjustedWealth = applyWeighting(wealth, voteWeighting);
      const votingPower = adjustedWealth > 0 ? avgWealth / adjustedWealth : 1;
      return { ...p, wealth, votingPower, adjustedWealth };
    });

    const totalVotingPower = participantsData.reduce((sum, p) => sum + p.votingPower, 0);

    const voteBreakdown = options.map(option => {
      const optionPower = participantsData
        .filter(p => p.vote === option)
        .reduce((sum, p) => sum + p.votingPower, 0);
      const percentage = totalVotingPower > 0 ? (optionPower / totalVotingPower) * 100 : 0;
      const voters = participantsData.filter(p => p.vote === option);
      return { option, percentage, voters };
    }).sort((a, b) => b.percentage - a.percentage);

    return { participantsData, totalVotingPower, voteBreakdown, options };
  }, [voteParticipants, voteOptions, voteWeighting, page]);

  const rentCalculations = useMemo(() => {
    if (page !== 'rent-results' || rentPeople.length === 0) return { rentAmount: 0, utilitiesAmount: 0, total: 0, totalRoomSize: 0, rentData: [], avgRent: 0, totalRoomValue: 0 };
    
    const rentAmount = parseFloat(totalRent) || 0;
    const utilitiesAmount = parseFloat(totalUtilities) || 0;
    const total = rentAmount + utilitiesAmount;
    const totalRoomSize = rentPeople.reduce((sum, p) => sum + (parseFloat(p.roomSize) || 0), 0);
    
    const peopleData = rentPeople.map(person => {
      const roomSize = parseFloat(person.roomSize) || 0;
      const wealth = parseFloat(person.wealth) || 0;
      const roomPct = totalRoomSize > 0 ? (roomSize / totalRoomSize) * 100 : 0;
      const adjustedWealth = applyWeighting(wealth, rentWeighting);
      const roomValue = roomPct * adjustedWealth;
      
      return { ...person, roomSize, wealth, roomPct, adjustedWealth, roomValue };
    });

    const totalRoomValue = peopleData.reduce((sum, p) => sum + p.roomValue, 0);
    
    const rentData = peopleData.map(p => ({
      ...p,
      fairRent: totalRoomValue > 0 ? (p.roomValue / totalRoomValue) * total : total / rentPeople.length,
      rentPct: totalRoomValue > 0 ? (p.roomValue / totalRoomValue) * 100 : 100 / rentPeople.length
    })).sort((a, b) => b.fairRent - a.fairRent);

    const avgRent = rentData.length > 0 ? total / rentData.length : 0;

    return { rentAmount, utilitiesAmount, total, totalRoomSize, rentData, avgRent, totalRoomValue };
  }, [rentPeople, totalRent, totalUtilities, rentWeighting, page]);

  if (page === 'entry-mockups') {
    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        <div className="bg-white p-8 border-2 border-dashed border-gray-400 mb-6">
          <h2 className="text-2xl font-black mb-4 text-black uppercase tracking-wider border-b-4 border-black pb-2">DATA ENTRY MOCKUPS</h2>
          <p className="text-xs mb-4 text-black">Alternative layouts for the bill-splitting data entry page. All maintain the receipt aesthetic while exploring different organizational approaches.</p>
          <button onClick={() => navigateTo('share-entry')} className="bg-gray-200 text-black px-6 py-2 font-bold border-2 border-gray-400 hover:bg-gray-300 transition-all">← BACK TO ENTRY</button>
        </div>

        <div className="bg-white p-8 border-2 border-dashed border-gray-400 mb-6">
          <p className="text-center text-black mb-4">All layout options have been removed.</p>
          <button onClick={() => navigateTo('share-entry')} className="w-full bg-gray-200 text-black px-6 py-2 font-bold border-2 border-gray-400 hover:bg-gray-300 transition-all">← BACK TO ENTRY</button>
        </div>

        {/* OPTION 1: TWO-COLUMN LAYOUT */}
        <div className="mb-8">
          <div className="bg-black text-white p-4 mb-3">
            <h3 className="text-lg font-black mb-1">OPTION 3: SIDE-BY-SIDE COLUMNS</h3>
            <p className="text-xs">Desktop-optimized with people and bills as equal columns</p>
          </div>
          
          <div className="bg-white p-6 border-2 border-dashed border-gray-400">
            <h2 className="text-xl font-black mb-3 text-black uppercase tracking-wider">BILL-SPLITTING</h2>
            <p className="text-xs mb-6 text-black">Handle shared expenses more fairly using wealth data.</p>
            
            <div className="grid md:grid-cols-2 gap-4">
              {/* People Column */}
              <div className="border-l-4 border-black pl-4">
                <h3 className="text-sm font-black text-black uppercase mb-3 pb-2 border-b border-dashed border-gray-400">PEOPLE</h3>
                
                <div className="space-y-2 mb-3">
                  <div className="bg-gray-50 p-2 border border-gray-300">
                    <div className="flex justify-between text-xs">
                      <span className="font-bold text-black">ALEX</span>
                      <span className="text-gray-600">$32,000</span>
                    </div>
                  </div>
                  <div className="bg-gray-50 p-2 border border-gray-300">
                    <div className="flex justify-between text-xs">
                      <span className="font-bold text-black">JORDAN</span>
                      <span className="text-gray-600">$180,000</span>
                    </div>
                  </div>
                  <div className="bg-gray-50 p-2 border border-gray-300">
                    <div className="flex justify-between text-xs">
                      <span className="font-bold text-black">SAM</span>
                      <span className="text-gray-600">$45,000</span>
                    </div>
                  </div>
                </div>
                
                <div className="space-y-2">
                  <input type="text" placeholder="NAME" className="w-full p-2 border border-gray-400 bg-white text-xs" />
                  <input type="number" placeholder="$ SALARY" className="w-full p-2 border border-gray-400 bg-white text-xs" />
                  <button className="w-full px-4 py-2 bg-black text-white font-bold text-xs">+ ADD PERSON</button>
                </div>
              </div>
              
              {/* Bills Column */}
              <div className="border-l-4 border-black pl-4">
                <h3 className="text-sm font-black text-black uppercase mb-3 pb-2 border-b border-dashed border-gray-400">BILLS</h3>
                
                <div className="space-y-2 mb-3">
                  <div className="bg-gray-50 p-2 border border-gray-300">
                    <div className="flex justify-between text-xs mb-1">
                      <span className="font-bold text-black">SKI PASSES</span>
                      <span className="text-gray-600">$1,200</span>
                    </div>
                    <p className="text-xs text-gray-600">Paid by JORDAN</p>
                  </div>
                  <div className="bg-gray-50 p-2 border border-gray-300">
                    <div className="flex justify-between text-xs mb-1">
                      <span className="font-bold text-black">CABIN RENTAL</span>
                      <span className="text-gray-600">$2,400</span>
                    </div>
                    <p className="text-xs text-gray-600">Paid by MORGAN</p>
                  </div>
                </div>
                
                <div className="space-y-2">
                  <input type="text" placeholder="DESCRIPTION" className="w-full p-2 border border-gray-400 bg-white text-xs" />
                  <input type="number" placeholder="$ AMOUNT" className="w-full p-2 border border-gray-400 bg-white text-xs" />
                  <select className="w-full p-2 border border-gray-400 bg-white text-xs">
                    <option>WHO PAID?</option>
                  </select>
                  <button className="w-full px-4 py-2 bg-black text-white font-bold text-xs">+ ADD BILL</button>
                </div>
              </div>
            </div>
            
            <div className="border-t-2 border-black mt-6 pt-4">
              <button className="w-full bg-black text-white py-3 font-black text-lg border-2 border-black">CALCULATE</button>
            </div>
          </div>
        </div>

        {/* OPTION 4: ALTERNATING GREY SECTIONS */}
        <div className="mb-8">
          <div className="bg-black text-white p-4 mb-3">
            <h3 className="text-lg font-black mb-1">OPTION 6: ALTERNATING GREY SECTIONS</h3>
            <p className="text-xs">Clear visual separation with alternating backgrounds</p>
          </div>
          
          <div className="bg-white p-6 border-2 border-dashed border-gray-400">
            <h2 className="text-xl font-black mb-3 text-black uppercase tracking-wider">BILL-SPLITTING</h2>
            <p className="text-xs mb-6 text-black">Handle shared expenses more fairly using wealth data.</p>
            
            {/* People Section */}
            <div className="bg-white border-l-4 border-black pl-4 pr-4 py-4 mb-4">
              <div className="flex items-center gap-2 mb-3">
                <svg width="20" height="20" viewBox="0 0 40 40">
                  <circle cx="20" cy="20" r="18" fill="#000"/>
                  <circle cx="20" cy="16" r="5" fill="white"/>
                  <path d="M 10 32 Q 10 24 20 24 Q 30 24 30 32" fill="white"/>
                </svg>
                <h3 className="text-sm font-black text-black uppercase">PEOPLE</h3>
              </div>
              
              <div className="grid grid-cols-3 gap-2 mb-3">
                <div className="bg-gray-100 p-2 border border-gray-300 text-center">
                  <p className="text-xs font-bold text-black">ALEX</p>
                  <p className="text-xs text-gray-600">$32K</p>
                </div>
                <div className="bg-gray-100 p-2 border border-gray-300 text-center">
                  <p className="text-xs font-bold text-black">JORDAN</p>
                  <p className="text-xs text-gray-600">$180K</p>
                </div>
                <div className="bg-gray-100 p-2 border border-gray-300 text-center">
                  <p className="text-xs font-bold text-black">SAM</p>
                  <p className="text-xs text-gray-600">$45K</p>
                </div>
              </div>
              
              <div className="flex gap-2">
                <input type="text" placeholder="NAME" className="flex-1 p-2 border border-gray-400 bg-white text-xs" />
                <input type="number" placeholder="$" className="w-24 p-2 border border-gray-400 bg-white text-xs" />
                <button className="px-3 py-2 bg-black text-white font-bold text-xs">+</button>
              </div>
            </div>
            
            {/* Bills Section */}
            <div className="bg-gray-50 border-l-4 border-black pl-4 pr-4 py-4 mb-4">
              <div className="flex items-center gap-2 mb-3">
                <svg width="20" height="20" viewBox="0 0 20 20">
                  <rect x="2" y="4" width="16" height="12" fill="none" stroke="#000" strokeWidth="2"/>
                  <line x1="2" y1="8" x2="18" y2="8" stroke="#000" strokeWidth="2"/>
                  <line x1="2" y1="12" x2="18" y2="12" stroke="#000" strokeWidth="2"/>
                </svg>
                <h3 className="text-sm font-black text-black uppercase">BILLS</h3>
              </div>
              
              <div className="space-y-2 mb-3">
                <div className="bg-white p-2 border border-gray-300 text-xs">
                  <div className="flex justify-between mb-1">
                    <span className="font-bold text-black">SKI PASSES</span>
                    <span className="text-gray-600">$1,200</span>
                  </div>
                  <span className="text-gray-600">JORDAN</span>
                </div>
                <div className="bg-white p-2 border border-gray-300 text-xs">
                  <div className="flex justify-between mb-1">
                    <span className="font-bold text-black">CABIN</span>
                    <span className="text-gray-600">$2,400</span>
                  </div>
                  <span className="text-gray-600">MORGAN</span>
                </div>
              </div>
              
              <div className="space-y-2">
                <input type="text" placeholder="DESCRIPTION" className="w-full p-2 border border-gray-400 bg-white text-xs" />
                <div className="flex gap-2">
                  <input type="number" placeholder="$ AMOUNT" className="flex-1 p-2 border border-gray-400 bg-white text-xs" />
                  <select className="flex-1 p-2 border border-gray-400 bg-white text-xs">
                    <option>PAID BY?</option>
                  </select>
                </div>
                <button className="w-full px-4 py-2 bg-black text-white font-bold text-xs">+ ADD BILL</button>
              </div>
            </div>
            
            <button className="w-full bg-black text-white py-3 font-black text-lg border-2 border-black">CALCULATE</button>
          </div>
        </div>

        {/* OPTION 7: COMPACT CARD STYLE */}
        <div className="mb-8">
          <div className="bg-black text-white p-4 mb-3">
            <h3 className="text-lg font-black mb-1">OPTION 7: COMPACT CARD STYLE</h3>
            <p className="text-xs">Dense information display with icon badges</p>
          </div>
          
          <div className="bg-white p-6 border-2 border-dashed border-gray-400">
            <h2 className="text-xl font-black mb-3 text-black uppercase tracking-wider">BILL-SPLITTING</h2>
            <p className="text-xs mb-6 text-black">Handle shared expenses more fairly using wealth data.</p>
            
            {/* People Card */}
            <div className="border-2 border-black mb-4">
              <div className="bg-black text-white p-3 flex items-center gap-2">
                <svg width="20" height="20" viewBox="0 0 40 40">
                  <circle cx="20" cy="20" r="18" fill="#FFF"/>
                  <circle cx="20" cy="16" r="5" fill="black"/>
                  <path d="M 10 32 Q 10 24 20 24 Q 30 24 30 32" fill="black"/>
                </svg>
                <span className="text-sm font-black uppercase">PEOPLE · 3</span>
              </div>
              <div className="p-3">
                <div className="flex flex-wrap gap-2 mb-3">
                  <div className="bg-gray-100 px-3 py-2 border border-gray-400 text-xs">
                    <span className="font-bold text-black">ALEX</span>
                    <span className="text-gray-600 ml-2">$32K</span>
                  </div>
                  <div className="bg-gray-100 px-3 py-2 border border-gray-400 text-xs">
                    <span className="font-bold text-black">JORDAN</span>
                    <span className="text-gray-600 ml-2">$180K</span>
                  </div>
                  <div className="bg-gray-100 px-3 py-2 border border-gray-400 text-xs">
                    <span className="font-bold text-black">SAM</span>
                    <span className="text-gray-600 ml-2">$45K</span>
                  </div>
                </div>
                <div className="flex gap-2">
                  <input type="text" placeholder="NAME" className="flex-1 p-2 border border-gray-400 bg-white text-xs" />
                  <input type="number" placeholder="$" className="w-20 p-2 border border-gray-400 bg-white text-xs" />
                  <button className="px-3 py-2 bg-black text-white font-bold text-xs">+</button>
                </div>
              </div>
            </div>
            
            {/* Bills Card */}
            <div className="border-2 border-black mb-4">
              <div className="bg-black text-white p-3 flex items-center gap-2">
                <svg width="20" height="20" viewBox="0 0 20 20">
                  <rect x="2" y="4" width="16" height="12" fill="none" stroke="#FFF" strokeWidth="2"/>
                  <line x1="2" y1="8" x2="18" y2="8" stroke="#FFF" strokeWidth="2"/>
                  <line x1="2" y1="12" x2="18" y2="12" stroke="#FFF" strokeWidth="2"/>
                </svg>
                <span className="text-sm font-black uppercase">BILLS · $5,035</span>
              </div>
              <div className="p-3">
                <div className="space-y-2 mb-3">
                  <div className="flex justify-between items-center text-xs bg-gray-50 p-2 border border-gray-300">
                    <span className="font-bold text-black">SKI PASSES</span>
                    <div className="text-right">
                      <div className="text-gray-600">$1,200</div>
                      <div className="text-gray-500 text-xs">JORDAN</div>
                    </div>
                  </div>
                  <div className="flex justify-between items-center text-xs bg-gray-50 p-2 border border-gray-300">
                    <span className="font-bold text-black">CABIN</span>
                    <div className="text-right">
                      <div className="text-gray-600">$2,400</div>
                      <div className="text-gray-500 text-xs">MORGAN</div>
                    </div>
                  </div>
                </div>
                <input type="text" placeholder="DESCRIPTION" className="w-full p-2 border border-gray-400 bg-white text-xs mb-2" />
                <div className="flex gap-2 mb-2">
                  <input type="number" placeholder="$ AMOUNT" className="flex-1 p-2 border border-gray-400 bg-white text-xs" />
                  <select className="flex-1 p-2 border border-gray-400 bg-white text-xs">
                    <option>WHO PAID?</option>
                  </select>
                </div>
                <button className="w-full px-4 py-2 bg-black text-white font-bold text-xs">+ ADD BILL</button>
              </div>
            </div>
            
            <button className="w-full bg-black text-white py-3 font-black text-lg border-2 border-black">CALCULATE</button>
          </div>
        </div>

        {/* OPTION 8: COLLAPSIBLE SECTIONS */}
        <div className="mb-8">
          <div className="bg-black text-white p-4 mb-3">
            <h3 className="text-lg font-black mb-1">OPTION 8: COLLAPSIBLE SECTIONS</h3>
            <p className="text-xs">Expandable panels with summary headers (shown expanded)</p>
          </div>
          
          <div className="bg-white p-6 border-2 border-dashed border-gray-400">
            <h2 className="text-xl font-black mb-3 text-black uppercase tracking-wider">BILL-SPLITTING</h2>
            <p className="text-xs mb-6 text-black">Handle shared expenses more fairly using wealth data.</p>
            
            {/* People Section */}
            <div className="border-2 border-gray-400 mb-4">
              <div className="bg-gray-100 p-3 flex items-center justify-between cursor-pointer">
                <div className="flex items-center gap-2">
                  <svg width="18" height="18" viewBox="0 0 40 40">
                    <circle cx="20" cy="20" r="18" fill="#000"/>
                    <circle cx="20" cy="16" r="5" fill="white"/>
                    <path d="M 10 32 Q 10 24 20 24 Q 30 24 30 32" fill="white"/>
                  </svg>
                  <span className="text-sm font-black text-black uppercase">PEOPLE</span>
                </div>
                <div className="flex items-center gap-3">
                  <span className="text-xs font-bold text-gray-600">3 ADDED</span>
                  <span className="text-xl font-bold text-black">▼</span>
                </div>
              </div>
              <div className="p-3 bg-white">
                <div className="space-y-1 mb-3">
                  <div className="text-xs p-2 bg-gray-50 border-l-2 border-black">
                    <span className="font-bold text-black">ALEX</span>
                    <span className="text-gray-600 ml-2">$32,000</span>
                  </div>
                  <div className="text-xs p-2 bg-gray-50 border-l-2 border-black">
                    <span className="font-bold text-black">JORDAN</span>
                    <span className="text-gray-600 ml-2">$180,000</span>
                  </div>
                </div>
                <div className="flex gap-2">
                  <input type="text" placeholder="NAME" className="flex-1 p-2 border border-gray-400 bg-white text-xs" />
                  <input type="number" placeholder="$" className="w-24 p-2 border border-gray-400 bg-white text-xs" />
                  <button className="px-3 py-2 bg-black text-white font-bold text-xs">+</button>
                </div>
              </div>
            </div>
            
            {/* Bills Section */}
            <div className="border-2 border-gray-400 mb-4">
              <div className="bg-gray-100 p-3 flex items-center justify-between cursor-pointer">
                <div className="flex items-center gap-2">
                  <svg width="18" height="18" viewBox="0 0 20 20">
                    <rect x="2" y="4" width="16" height="12" fill="none" stroke="#000" strokeWidth="2"/>
                    <line x1="2" y1="8" x2="18" y2="8" stroke="#000" strokeWidth="2"/>
                    <line x1="2" y1="12" x2="18" y2="12" stroke="#000" strokeWidth="2"/>
                  </svg>
                  <span className="text-sm font-black text-black uppercase">BILLS</span>
                </div>
                <div className="flex items-center gap-3">
                  <span className="text-xs font-bold text-gray-600">$5,035</span>
                  <span className="text-xl font-bold text-black">▼</span>
                </div>
              </div>
              <div className="p-3 bg-white">
                <div className="space-y-1 mb-3">
                  <div className="text-xs p-2 bg-gray-50 border-l-2 border-black">
                    <div className="flex justify-between mb-1">
                      <span className="font-bold text-black">SKI PASSES</span>
                      <span className="text-gray-600">$1,200</span>
                    </div>
                    <span className="text-gray-500">JORDAN</span>
                  </div>
                  <div className="text-xs p-2 bg-gray-50 border-l-2 border-black">
                    <div className="flex justify-between mb-1">
                      <span className="font-bold text-black">CABIN</span>
                      <span className="text-gray-600">$2,400</span>
                    </div>
                    <span className="text-gray-500">MORGAN</span>
                  </div>
                </div>
                <div className="space-y-2">
                  <input type="text" placeholder="DESCRIPTION" className="w-full p-2 border border-gray-400 bg-white text-xs" />
                  <div className="flex gap-2">
                    <input type="number" placeholder="$ AMOUNT" className="flex-1 p-2 border border-gray-400 bg-white text-xs" />
                    <select className="flex-1 p-2 border border-gray-400 bg-white text-xs">
                      <option>PAID BY?</option>
                    </select>
                  </div>
                  <button className="w-full px-4 py-2 bg-black text-white font-bold text-xs">+ ADD BILL</button>
                </div>
              </div>
            </div>
            
            <button className="w-full bg-black text-white py-3 font-black text-lg border-2 border-black">CALCULATE</button>
          </div>
        </div>

      </Layout>
    );
  }

  if (page === 'home') {
    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        <p className="text-center text-sm mb-4 text-black leading-relaxed font-bold">THE FAIRER WAY TO SPLIT COSTS WITH FRIENDS.</p>
        <p className="text-center text-sm mb-4 text-black leading-relaxed">COMRADE COMBINES AND SIMPLIFIES GROUP BILLS — THEN DIVIDES THEM BASED ON WEALTH.</p>
        <div className="space-y-4 max-w-md mx-auto mb-4">
          <button onClick={() => navigateTo('share-entry')} className="w-full bg-black text-white font-bold py-4 px-6 border-2 border-black hover:bg-gray-800 transition-all text-xl">GET STARTED</button>
        </div>
        
        <CurrencyDivider />
        
        {/* How It Works Section */}
        <div className="bg-white p-8 border-2 border-dashed border-gray-400 mb-4">
          <h2 className="text-xl font-black mb-6 text-black uppercase tracking-wider text-center">HOW IT WORKS</h2>
          
          <div className="space-y-6">
            <div className="flex gap-4 items-start">
              <div className="bg-black text-white font-black text-4xl w-16 h-16 flex items-center justify-center border-2 border-black flex-shrink-0">1</div>
              <div>
                <h3 className="font-bold text-black uppercase mb-1">ADD YOUR GROUP</h3>
                <p className="text-xs text-black">Enter everyone's names, and incomes or net worth</p>
              </div>
            </div>
            
            <div className="flex justify-center gap-2 py-2">
              <svg width="40" height="40" viewBox="0 0 40 40">
                <circle cx="20" cy="20" r="18" fill="#D1D5DB"/>
                <circle cx="20" cy="16" r="6" fill="white"/>
                <path d="M 10 32 Q 10 24 20 24 Q 30 24 30 32" fill="white"/>
              </svg>
              <svg width="40" height="40" viewBox="0 0 40 40">
                <circle cx="20" cy="20" r="18" fill="#9CA3AF"/>
                <circle cx="20" cy="16" r="6" fill="white"/>
                <path d="M 10 32 Q 10 24 20 24 Q 30 24 30 32" fill="white"/>
              </svg>
              <svg width="40" height="40" viewBox="0 0 40 40">
                <circle cx="20" cy="20" r="18" fill="#6B7280"/>
                <circle cx="20" cy="16" r="6" fill="white"/>
                <path d="M 10 32 Q 10 24 20 24 Q 30 24 30 32" fill="white"/>
              </svg>
            </div>
            
            <div className="flex gap-4 items-start">
              <div className="bg-black text-white font-black text-4xl w-16 h-16 flex items-center justify-center border-2 border-black flex-shrink-0">2</div>
              <div>
                <h3 className="font-bold text-black uppercase mb-1">ENTER YOUR BILLS</h3>
                <p className="text-xs text-black">List what was spent, and who paid</p>
              </div>
            </div>
            
            <div className="flex justify-center py-2 px-16">
              <div className="space-y-2 w-full">
                <div className="flex justify-between items-center text-xs font-bold text-gray-500 border-b-2 border-dashed border-gray-400 pb-1">
                  <div className="flex items-center gap-2">
                    <div className="w-2 h-2 rounded-full" style={{backgroundColor: '#D1D5DB'}}></div>
                    <span>DINNER</span>
                  </div>
                  <span>$95</span>
                </div>
                <div className="flex justify-between items-center text-xs font-bold text-gray-500 border-b-2 border-dashed border-gray-400 pb-1">
                  <div className="flex items-center gap-2">
                    <div className="w-2 h-2 rounded-full" style={{backgroundColor: '#9CA3AF'}}></div>
                    <span>GAS</span>
                  </div>
                  <span>$45</span>
                </div>
                <div className="flex justify-between items-center text-xs font-bold text-gray-500 border-b-2 border-dashed border-gray-400 pb-1">
                  <div className="flex items-center gap-2">
                    <div className="w-2 h-2 rounded-full" style={{backgroundColor: '#6B7280'}}></div>
                    <span>HOTEL</span>
                  </div>
                  <span>$300</span>
                </div>
              </div>
            </div>
            
            <div className="flex gap-4 items-start">
              <div className="bg-black text-white font-black text-4xl w-16 h-16 flex items-center justify-center border-2 border-black flex-shrink-0">3</div>
              <div>
                <h3 className="font-bold text-black uppercase mb-1">GET FAIR RESULTS</h3>
                <p className="text-xs text-black">See who owes what, based on ability to pay</p>
              </div>
            </div>
            
            <div className="flex justify-center py-2">
              <svg width="80" height="80" viewBox="0 0 80 80">
                <path d="M 40 5 A 35 35 0 0 1 52.5 71.2 L 40 40 Z" fill="#D1D5DB" stroke="white" strokeWidth="2"/>
                <path d="M 40 40 L 52.5 71.2 A 35 35 0 0 1 8.8 52.5 L 40 40 Z" fill="#9CA3AF" stroke="white" strokeWidth="2"/>
                <path d="M 40 40 L 8.8 52.5 A 35 35 0 0 1 40 5 L 40 40 Z" fill="#6B7280" stroke="white" strokeWidth="2"/>
              </svg>
            </div>
          </div>
          
          <div className="mt-6">
            <div className="flex flex-wrap justify-center gap-3">
              <button onClick={() => navigateTo('share-entry')} className="bg-black text-white font-bold py-4 px-8 border-2 border-black hover:bg-gray-800 transition-all text-lg" style={{wordBreak: 'keep-all', hyphens: 'none'}}>TRY IT NOW</button>
              <button onClick={() => navigateTo('about')} className="bg-white text-black font-bold py-4 px-8 border-2 border-black hover:bg-gray-100 transition-all text-lg" style={{wordBreak: 'keep-all', hyphens: 'none'}}>LEARN MORE</button>
            </div>
          </div>
        </div>
        
        <CurrencyDivider />
        
        <div className="bg-white p-8 border-2 border-dashed border-gray-400 mb-4">
          <div className="max-w-md mx-auto">
            <p className="text-center text-xs font-bold text-gray-600 mb-3 uppercase tracking-wider">ADDITIONAL TOOLS</p>
            <div className="space-y-3">
              <button onClick={() => navigateTo('rent-entry')} className="w-full bg-white text-black font-bold py-4 px-6 border-2 border-black hover:bg-gray-100 transition-all">RENTING AN APARTMENT?</button>
              <button onClick={() => navigateTo('sale-entry')} className="w-full bg-white text-black font-bold py-4 px-6 border-2 border-black hover:bg-gray-100 transition-all">SELLING SOMETHING?</button>
            </div>
          </div>
          <div className="mt-8 pt-6 border-t-2 border-dashed border-gray-400 max-w-md mx-auto">
            <p className="text-center text-xs font-bold text-gray-600 mb-3 uppercase tracking-wider">EXPERIMENTAL</p>
            <button onClick={() => navigateTo('vote-entry')} className="w-full bg-gray-200 text-black font-bold py-4 px-6 border-2 border-gray-400 hover:bg-gray-300 transition-all">VOTING ON A DECISION?</button>
          </div>
        </div>
      </Layout>
    );
  }

  if (page === 'about') {
    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        {/* About section */}
        <h2 className="text-2xl font-black mb-4 text-black uppercase tracking-wider border-b-4 border-black pb-2">ABOUT</h2>
        
        {/* Illustration */}
        <div className="mb-6">
          <div className="bg-white p-4">
            <svg width="100%" height="60" viewBox="0 0 600 60" preserveAspectRatio="xMidYMid meet">
              <g transform="translate(50, 30)">
                <text x="0" y="12" fontFamily="Sixtyfour, monospace" fontSize="32" fill="#000" fontWeight="bold" textAnchor="middle">$</text>
              </g>
              
              <g transform="translate(150, 30)">
                <rect x="-30" y="8" width="12" height="15" fill="#000"/>
                <rect x="-15" y="-3" width="12" height="26" fill="#666"/>
                <rect x="0" y="5" width="12" height="18" fill="#999"/>
                <rect x="15" y="-8" width="12" height="31" fill="#000"/>
                <line x1="-30" y1="23" x2="27" y2="23" stroke="#000" strokeWidth="2"/>
              </g>
              
              <g transform="translate(250, 30)">
                <text x="0" y="12" fontFamily="Sixtyfour, monospace" fontSize="32" fill="#000" fontWeight="bold" textAnchor="middle">€</text>
              </g>
              
              <g transform="translate(350, 30)">
                <circle cx="0" cy="0" r="18" fill="#666"/>
                <circle cx="0" cy="-4" r="5" fill="white"/>
                <path d="M -10 12 Q -10 4 0 4 Q 10 4 10 12" fill="white"/>
              </g>
              
              <g transform="translate(450, 30)">
                <text x="0" y="12" fontFamily="Sixtyfour, monospace" fontSize="32" fill="#000" fontWeight="bold" textAnchor="middle">£</text>
              </g>
              
              <g transform="translate(550, 30)">
                <path d="M 0 0 L 0 -22 A 22 22 0 0 1 15.6 15.6 Z" fill="#000"/>
                <path d="M 0 0 L 15.6 15.6 A 22 22 0 0 1 -11 19 Z" fill="#666"/>
                <path d="M 0 0 L -11 19 A 22 22 0 0 1 -21.1 -5.7 Z" fill="#999"/>
                <path d="M 0 0 L -21.1 -5.7 A 22 22 0 0 1 0 -22 Z" fill="#CCC"/>
              </g>
            </svg>
          </div>
        </div>
        
        <div className="space-y-4 text-black mb-4">
          <p className="leading-relaxed text-xs">If a banker, a nurse, and a student go out for dinner, how should they split the bill?</p>
          
          <p className="leading-relaxed text-xs">Comrade is an app for managing group expenses that takes the awkwardness out of bill-splitting. Whether it's a weekend trip, household purchases, or a work dinner, it simplifies group bills and divides them fairly — by taking into account people's wealth (salaries or net worth) to decide the split. Those who have more, pay more.</p>
          
          <p className="leading-relaxed text-xs">Wealth isn't evenly distributed. Costs shouldn't be either. So next time your friends, family, or coworkers need to split the check, use Comrade for a fairer way to settle up.</p>
          
          <p className="leading-relaxed text-xs">Beyond <span className="underline cursor-pointer hover:text-gray-600" onClick={() => navigateTo('share-entry')}>bill-splitting</span>, Comrade offers a number of other features. There is a tool to help decide <span className="underline cursor-pointer hover:text-gray-600" onClick={() => navigateTo('rent-entry')}>rent splits</span> in apartments more fairly, another to assist when <span className="underline cursor-pointer hover:text-gray-600" onClick={() => navigateTo('sale-entry')}>selling</span> an item to ensure the buyer is the person who values it most highly, and an experimental tool for <span className="underline cursor-pointer hover:text-gray-600" onClick={() => navigateTo('vote-entry')}>voting</span> on decisions.</p>
        </div>

        <CurrencyDivider />

        {/* Email sign-up box */}
        <div className="mb-4">
          {renderEmailSignup()}
        </div>

        {/* FAQ box */}
        <div className="bg-white p-8 border-2 border-dashed border-gray-400">
          <h2 className="text-2xl font-black mb-4 text-black uppercase tracking-wider border-b-4 border-black pb-2">FAQ</h2>
          <div className="space-y-6 text-black">
            <div>
              <h3 className="font-bold mb-2 text-sm uppercase tracking-wider">HOW DOES THIS WORK?</h3>
              <p className="leading-relaxed text-xs">Comrade uses wealth data to decide how much each person should pay. It combines all the bills and the amounts already paid, then looks at each person's wealth in relation to others in the group to establish what proportion of the total amount each person should actually be responsible for.</p>
              <div className="border-t border-dashed border-gray-400 mt-4"></div>
            </div>
            <div>
              <h3 className="font-bold mb-2 text-sm uppercase tracking-wider">WHAT IS "WEIGHTING"?</h3>
              <p className="leading-relaxed text-xs mb-2">Weighting is the level of emphasis placed on each user's relative wealth (salary/net worth). By default, each person's responsibility is directly correlated with their wealth.</p>
              <p className="leading-relaxed text-xs mb-2">For example, let's say Fred and George each paid $100 on shared bills. Fred earns $50,000 a year, while George brings in $100,000. With regular ("Mid") weighting, because George makes twice as much money as Fred, he should pay twice as much. So far, he only paid 50% — $100 — meaning he owes Fred another $33.33.</p>
              <p className="leading-relaxed text-xs mb-2">In settings, you can also select "High" weighting, which emphasizes wealth differences even more by using squared wealth values for calculations; or "Low" weighting, which uses square-root values for more gentle adjustments. There is also an option to forego weighting entirely.</p>
              <p className="leading-relaxed text-xs">Comrade's other tools — for rent-splitting, selling, and voting — use people's wealth to weigh their inputs in a similar way.</p>
              <div className="border-t border-dashed border-gray-400 mt-4"></div>
            </div>
            <div>
              <h3 className="font-bold mb-2 text-sm uppercase tracking-wider">WHAT DO YOU DO WITH MY FINANCIAL INFORMATION?</h3>
              <p className="leading-relaxed text-xs">Nothing.</p>
              <div className="border-t border-dashed border-gray-400 mt-4"></div>
            </div>
            <div>
              <h3 className="font-bold mb-2 text-sm uppercase tracking-wider">NOTHING?</h3>
              <p className="leading-relaxed text-xs mb-2">Nothing. All calculations are performed on the user's device. Comrade does not receive or save user data.</p>
              <p className="leading-relaxed text-xs">If a user signs up for email updates, their email is shared with Comrade only, and is not associated with any financial data. (Because, again, their financial data is never saved.)</p>
              <div className="border-t border-dashed border-gray-400 mt-4"></div>
            </div>
            <div>
              <h3 className="font-bold mb-2 text-sm uppercase tracking-wider">WHO BUILT THIS?</h3>
              <p className="leading-relaxed text-xs">Comrade is a startup based in Brooklyn, New York. Get in touch at <a href="mailto:hello@comrade.money" className="underline hover:text-gray-600">hello@comrade.money</a></p>
              <div className="border-t border-dashed border-gray-400 mt-4"></div>
            </div>
            <div>
              <h3 className="font-bold mb-2 text-sm uppercase tracking-wider">IT'S AWKWARD ASKING MY FRIENDS HOW MUCH MONEY THEY HAVE. WHAT SHOULD I DO?</h3>
              <p className="leading-relaxed text-xs">Do it anyway. <a href="https://www.hbs.edu/ris/Publication%20Files/23-039_f20d86a0-a1cf-4bd6-8066-74ccc6f2c3cf.pdf" target="_blank" rel="noopener noreferrer" className="underline hover:text-gray-600">Studies</a> have found <a href="https://www.nytimes.com/interactive/2020/02/19/magazine/salary-sharing.html" target="_blank" rel="noopener noreferrer" className="underline hover:text-gray-600">breaking</a> the <a href="https://www.businessinsider.com/salary-pay-transparency-jobs-income-taboo-equity-2023-1" target="_blank" rel="noopener noreferrer" className="underline hover:text-gray-600">taboos</a> around sharing information about wealth makes society better.</p>
              <div className="border-t border-dashed border-gray-400 mt-4"></div>
            </div>
            <div>
              <h3 className="font-bold mb-2 text-sm uppercase tracking-wider">IS THIS SERIOUS?</h3>
              <p className="leading-relaxed text-xs">What do you think?</p>
            </div>
          </div>
        </div>
      </Layout>
    );
  }

  if (page === 'legal') {
    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        <div className="bg-white p-8 border-2 border-dashed border-gray-400">
          <h2 className="text-2xl font-black mb-4 text-black uppercase tracking-wider border-b-4 border-black pb-2">LEGAL</h2>
          <div className="text-black space-y-4">
            <p className="leading-relaxed text-xs">Comrade does not collect, store, or transmit any financial information or personal data entered into the application. All calculations are performed locally in your browser.</p>
            <div className="border-t border-dashed border-gray-400"></div>
            <p className="leading-relaxed text-xs">This application is provided for informational purposes only. Users are solely responsible for their own actions. The creators of Comrade are not liable for any outcomes, disputes, consequences, or bad decisions resulting from the use of Comrade and its calculations. Sorry!</p>
            <div className="border-t border-dashed border-gray-400"></div>
            <p className="leading-relaxed text-xs">By entering your email address, you consent to Comrade and its team contacting you about updates to the app, news, other projects they may be working on, and other cool stuff. Comrade will not sell your personal information to third parties.</p>
            <div className="border-t border-dashed border-gray-400"></div>
            <p className="leading-relaxed text-xs">This application is available under a Creative Commons Attribution-NonCommercial 4.0 International License (CC BY-NC 4.0).</p>
          </div>
        </div>
      </Layout>
    );
  }

  if (page === 'share-entry') {
    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        <EntryPageWrapper
          title="BILL-SPLITTING"
          description="From meals to vacations, taxis to tickets, handle your shared expenses with friends more fairly. Comrade combines and simplifies group bills, while using information about group members' finances to decide how much everyone should pay."
          type="share"
          settingsComponent={renderSettingsPanel(shareWeighting, setShareWeighting, showShareSettings, setShowShareSettings, 'share-results', shareCurrency, setShareCurrency, shareWealthMetric, setShareWealthMetric, undefined, undefined)}
        >
          {/* Box 2: People and Bills */}
          <div className="bg-white p-8 border-2 border-dashed border-gray-400 mb-4">
          <div className="mb-6">
            <div className="flex items-center gap-2 mb-4">
              <svg width="20" height="20" viewBox="0 0 40 40">
                <circle cx="20" cy="20" r="18" fill="#000"/>
                <circle cx="20" cy="16" r="5" fill="white"/>
                <path d="M 10 32 Q 10 24 20 24 Q 30 24 30 32" fill="white"/>
              </svg>
              <h3 className="text-lg font-bold text-black uppercase tracking-wider">PEOPLE</h3>
            </div>
            <p className="text-xs mb-3 text-black">List the people splitting the costs, including their financial resources.</p>
            
            <AddItemCard
              title=""
              containerClassName=""
              fields={[
              {
                value: currentPersonName,
                onChange: (e) => setCurrentPersonName(e.target.value),
                placeholder: "NAME",
                minWidth: '140px'
              },
              {
                value: currentPersonWealth,
                onChange: (e) => setCurrentPersonWealth(e.target.value),
                placeholder: `${getCurrencySymbol(shareCurrency)} ${getWealthMetricLabel(shareWealthMetric).toUpperCase()}`,
                type: 'number',
                min: '0',
                step: '0.01',
                inputMode: 'decimal',
                minWidth: '180px'
              }
            ]}
            onAdd={() => {
              if (currentPersonName.trim()) {
                setSharePeople([...sharePeople, {
                  id: Date.now(),
                  name: currentPersonName,
                  wealth: currentPersonWealth
                }]);
                setCurrentPersonName('');
                setCurrentPersonWealth('');
              }
            }}
            items={sharePeople}
            onDelete={(id) => setSharePeople(sharePeople.filter(p => p.id !== id))}
            renderItem={(person) => (
              <>
                <p className={`${CLS.textXsBlack} ${CLS.fontBoldBlackUpper}`}>{person.name}</p>
                <p className={CLS.textXsBlack}>{getWealthMetricLabel(shareWealthMetric)}: {formatCurrency(person.wealth, 2, shareCurrency)}</p>
              </>
            )}
            addButtonLabel="+ ADD PERSON"
            />
          </div>

          <div className="border-t-2 border-dashed border-gray-400 my-6"></div>

          <div>
            <div className="flex items-center gap-2 mb-4">
              <BillIcon />
              <h3 className="text-lg font-bold text-black uppercase tracking-wider">BILLS</h3>
            </div>
            <p className="text-xs mb-3 text-black">Add all the expenses the group is splitting, along with who already paid for what.</p>
            
            <AddItemCard
              title=""
              containerClassName=""
              fields={[
              {
                value: currentBillDescription,
                onChange: (e) => setCurrentBillDescription(e.target.value),
                placeholder: "DESCRIPTION",
                minWidth: '150px'
              },
              {
                value: currentBillAmount,
                onChange: (e) => setCurrentBillAmount(e.target.value),
                placeholder: `${getCurrencySymbol(shareCurrency)} AMOUNT`,
                type: 'number',
                min: '0',
                step: '0.01',
                inputMode: 'decimal',
                minWidth: '150px'
              },
              {
                type: 'select',
                value: currentBillPaidBy,
                onChange: (e) => setCurrentBillPaidBy(e.target.value),
                placeholder: "WHO PAID?",
                options: sharePeople.map(p => ({ value: p.name, label: p.name })),
                minWidth: '150px'
              }
            ]}
            onAdd={() => {
              if (currentBillDescription.trim()) {
                setShareBills([...shareBills, {
                  id: Date.now(),
                  description: currentBillDescription,
                  amount: currentBillAmount,
                  paidBy: currentBillPaidBy
                }]);
                setCurrentBillDescription('');
                setCurrentBillAmount('');
                setCurrentBillPaidBy('');
              }
            }}
            items={shareBills}
            onDelete={(id) => setShareBills(shareBills.filter(b => b.id !== id))}
            renderItem={(bill) => (
              <>
                <p className={`${CLS.textXsBlack} ${CLS.fontBoldBlackUpper}`}>{bill.description}</p>
                <p className={CLS.textXsBlack}>{bill.paidBy || 'Unknown'} paid: {formatCurrency(bill.amount, 2, shareCurrency)}</p>
              </>
            )}
            addButtonLabel="+ ADD BILL"
            />
          </div>
        </div>

        </EntryPageWrapper>
      </Layout>
    );
  }

  if (page === 'share-results') {
    const { total, peopleData, transactions } = shareCalculations;
    const hasData = sharePeople.length > 0 && shareBills.length > 0 && shareBills.some(b => parseFloat(b.amount) > 0);

    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        <h2 className="text-2xl font-black mb-6 text-black uppercase tracking-wider border-b-4 border-black pb-2">BILL-SPLITTING RESULTS</h2>
        
        {!hasData && renderNoDataState('share-entry')}

        {hasData && (
          <>
            <div className="bg-black text-white p-8 mb-4 border-4 border-black">
              <h3 className="text-xl font-black mb-4 uppercase tracking-wider border-b-2 border-white pb-2">YOUR SETTLEMENT</h3>
              {transactions.length === 0 ? (
                <p className="text-lg font-bold">ALL SETTLED! EVERYONE'S SQUARE.</p>
              ) : (
                <div className="space-y-3">
                  {transactions.map((t, i) => (
                    <div key={i} className="text-sm leading-relaxed border-b border-dashed border-white pb-2">
                      <span className="font-semibold">{t.from.toUpperCase()}</span>
                      <span> PAYS </span>
                      <span className="font-semibold">{t.to.toUpperCase()}</span>
                      <br/>
                      <span className="font-black text-2xl">{formatCurrencySmart(t.amount, shareCurrency)}</span>
                    </div>
                  ))}
                </div>
              )}
              <p className="text-xs mt-4 border-t-2 border-dashed border-white pt-2">
                {transactions.length} TRANSACTION{transactions.length !== 1 ? 'S' : ''} TO SETTLE {formatCurrency(total, 2, shareCurrency)}
              </p>
            </div>

            {renderStatsRow([
              { label: 'TOTAL BILLS', value: shareBills.length },
              { label: 'TOTAL AMOUNT', value: formatCurrency(total, 2, shareCurrency) },
              { label: 'PEOPLE', value: sharePeople.length },
              { label: 'WEIGHTING', value: getWeightingLabel(shareWeighting) }
            ])}

            <DetailToggleButton show={showShareDetails} onClick={() => setShowShareDetails(!showShareDetails)} />

              {showShareDetails && (
                <div className="animate-fadeIn">
                  <DashedDivider />
                  
                  <div className="mb-6">
                    <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">PARTICIPANT DATA</h3>
                    
                    <div className="space-y-3">
                      {[...peopleData].sort((a, b) => b.wealth - a.wealth).map((p, idx) => {
                        const balance = p.paid - p.fairShare;
                        const colorClass = balance > 0.01 ? 'text-black' : balance < -0.01 ? 'text-black' : 'text-gray-600';
                        
                        return (
                          <div key={p.id || idx} className={CLS.bgWhiteP4Border2}>
                            <p className={`font-bold text-sm text-black mb-3 uppercase ${CLS.borderDashedGray} pb-2`}>
                              {p.name}
                            </p>
                            <div className={`space-y-2 ${CLS.textXsBlack}`}>
                              <div className="flex justify-between">
                                <span className={CLS.textBlackFontBold}>WEALTH:</span>
                                <span className="font-semibold text-black">{formatCurrency(p.wealth, 2, shareCurrency)}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className={CLS.textBlackFontBold}>PAID:</span>
                                <span className="font-semibold text-black">{formatCurrency(p.paid, 2, shareCurrency)} ({p.paidPct.toFixed(1)}%)</span>
                              </div>
                              <div className="flex justify-between">
                                <span className={CLS.textBlackFontBold}>FAIR SHARE:</span>
                                <span className="font-semibold text-black">{formatCurrencySmart(p.fairShare, shareCurrency)} ({p.fairPct.toFixed(1)}%)</span>
                              </div>
                              <div className={`flex justify-between pt-2 border-t ${CLS.borderDashedGray}`}>
                                <span className={CLS.textBlackFontBold}>BALANCE:</span>
                                <span className={`font-black ${colorClass}`}>{balance > 0.01 ? '+' : ''}{formatCurrencySmart(balance, shareCurrency)}</span>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  <DashedDivider />

                  <div className="mb-6">
                    <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">BILL RECAP</h3>
                    
                    <div className={CLS.bgWhiteP6Border2}>
                      <div className="space-y-3 mb-4">
                        {shareBills.map((bill, idx) => (
                          <div key={bill.id || idx} className={`flex justify-between items-start ${CLS.textXsBlack} border-b ${CLS.borderDashedGray} pb-2`}>
                            <div className="flex-1">
                              <p className={`${CLS.textBlackFontBold} uppercase`}>{bill.description}</p>
                              <p className={`text-black ${CLS.textXsBlack}`}>{bill.paidBy || 'Unknown'}</p>
                            </div>
                            <span className={`${CLS.textBlackFontBold} ml-4`}>{formatCurrency(bill.amount, 2, shareCurrency)}</span>
                          </div>
                        ))}
                      </div>
                      <div className="flex justify-between items-center pt-3 border-t-2 border-black">
                        <span className="font-black text-black uppercase">TOTAL</span>
                        <span className="font-black text-black text-lg">{formatCurrency(total, 2, shareCurrency)}</span>
                      </div>
                    </div>
                  </div>

                  <DashedDivider />

                  <div className="mb-6">
                    <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">WEALTH VISUALIZATION</h3>
                    {renderWealthPieChart(peopleData, formatNumber)}
                  </div>

                  <DashedDivider />

                  {renderBarVisualization(
                    'PAYMENT VISUALIZATION',
                    [...peopleData].sort((a, b) => b.wealth - a.wealth),
                    [
                      {
                        label: 'PAID',
                        getValue: (p) => p.paid,
                        displayValue: (p) => `${p.paidPct.toFixed(0)}%`,
                        rightLabel: (p) => formatCurrency(p.paid, 2, shareCurrency)
                      },
                      {
                        label: 'FAIR',
                        getValue: (p) => p.fairShare,
                        displayValue: (p) => `${p.fairPct.toFixed(0)}%`,
                        rightLabel: (p) => formatCurrencySmart(p.fairShare, shareCurrency)
                      }
                    ],
                    (p) => p.name
                  )}
                </div>
              )}
            </>
          )}

        {renderResultsFooter(
          hasData,
          `Comrade | Bill-splitting results\n\nTotal: ${formatCurrency(total, 2, shareCurrency)}\n\nBreakdown:\n${peopleData.map(p => `${p.name}: Paid ${formatCurrency(p.paid, 2, shareCurrency)}, fair share ${formatCurrencySmart(p.fairShare, shareCurrency)}`).join('\n')}\n\nSettlements:\n${transactions.length === 0 ? 'All settled!' : transactions.map(t => `${t.from} pays ${t.to} ${formatCurrencySmart(t.amount, shareCurrency)}`).join('\n')}\n\nCalculated using www.comrade.money — the fairer way to split costs with friends.`,
          'share-entry'
        )}
      </Layout>
    );
  }

  if (page === 'sale-entry') {
    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        <EntryPageWrapper
          title="SELLING"
          description="If you're selling something, make sure it goes to the potential buyer who needs it the most — not just whoever offers to pay the most. Comrade takes into account prospective purchasers' financial resources to help you understand how much your product is truly worth to them."
          type="sale"
          settingsComponent={renderSettingsPanel(saleWeighting, setSaleWeighting, showSaleSettings, setShowSaleSettings, 'sale-results', saleCurrency, setSaleCurrency, saleWealthMetric, setSaleWealthMetric, undefined, undefined)}
        >
          {/* Box 2: Product Info and Potential Buyers */}
          <div className="bg-white p-8 border-2 border-dashed border-gray-400 mb-4">
          <div className="mb-6">
            <div className="flex items-center gap-2 mb-4">
              <svg width="20" height="20" viewBox="0 0 24 24">
                <path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z" fill="#000"/>
              </svg>
              <h3 className="text-lg font-bold text-black uppercase tracking-wider">PRODUCT DETAILS</h3>
            </div>
            <p className="text-xs mb-3 text-black">List what you're selling, and how many items are available.</p>
            <FormInput
              value={productName}
              onChange={(e) => setProductName(e.target.value)}
              placeholder="PRODUCT NAME"
              className="mb-3"
            />
            <FormInput
              type="number"
              value={numberAvailable}
              onChange={(e) => setNumberAvailable(e.target.value)}
              placeholder="NUMBER AVAILABLE"
              min="1"
              step="1"
              inputMode="numeric"
            />
          </div>

          <div className="border-t-2 border-dashed border-gray-400 my-6"></div>

          <div>
            <div className="flex items-center gap-2 mb-4">
              <PersonIcon />
              <h3 className="text-lg font-bold text-black uppercase tracking-wider">POTENTIAL BUYERS</h3>
            </div>
            <p className="text-xs mb-3 text-black">Add all the people interested in buying, along with their financial information.</p>
            
            <AddItemCard
              title=""
              containerClassName=""
              fields={[
              {
                value: currentBuyerName,
                onChange: (e) => setCurrentBuyerName(e.target.value),
                placeholder: "NAME",
                minWidth: '120px'
              },
              {
                value: currentBuyerWealth,
                onChange: (e) => setCurrentBuyerWealth(e.target.value),
                placeholder: `${getCurrencySymbol(saleCurrency)} ${getWealthMetricLabel(saleWealthMetric).toUpperCase()}`,
                type: 'number',
                min: '0',
                step: '0.01',
                inputMode: 'decimal',
                minWidth: '150px'
              },
              {
                value: currentBuyerOffer,
                onChange: (e) => setCurrentBuyerOffer(e.target.value),
                placeholder: `${getCurrencySymbol(saleCurrency)} OFFER`,
                type: 'number',
                min: '0',
                step: '0.01',
                inputMode: 'decimal',
                minWidth: '120px'
              }
            ]}
            onAdd={() => {
              if (currentBuyerName.trim()) {
                setSaleBuyers([...saleBuyers, {
                  id: Date.now(),
                  name: currentBuyerName,
                  wealth: currentBuyerWealth,
                  offer: currentBuyerOffer
                }]);
                setCurrentBuyerName('');
                setCurrentBuyerWealth('');
                setCurrentBuyerOffer('');
              }
            }}
            items={saleBuyers}
            onDelete={(id) => setSaleBuyers(saleBuyers.filter(b => b.id !== id))}
            renderItem={(buyer) => (
              <>
                <p className={`${CLS.textXsBlack} ${CLS.fontBoldBlackUpper}`}>{buyer.name}</p>
                <p className={CLS.textXsBlack}>{getWealthMetricLabel(saleWealthMetric)}: {formatCurrency(buyer.wealth, 2, saleCurrency)}</p>
                <p className={CLS.textXsBlack}>Offer: {formatCurrency(buyer.offer, 2, saleCurrency)}</p>
              </>
            )}
            addButtonLabel="+ ADD BUYER"
            />
          </div>
        </div>

        </EntryPageWrapper>
      </Layout>
    );
  }

  if (page === 'sale-results') {
    const { rankedBuyers, totalOffers, avgOffer } = saleCalculations;
    const numAvailable = parseInt(numberAvailable) || 1;
    const winners = rankedBuyers.slice(0, numAvailable);
    const hasData = saleBuyers.length > 0 && productName.trim();
    const isPerfectTie = hasData && rankedBuyers.length > 1 && rankedBuyers[0].needScore === rankedBuyers[1].needScore && rankedBuyers[0].needScore > 0;

    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        <h2 className="text-2xl font-black mb-6 text-black uppercase tracking-wider border-b-4 border-black pb-2">SELLING RESULTS</h2>
        
        {!hasData && renderNoDataState('sale-entry')}

        {hasData && (
          <>
            <div className="bg-black text-white p-8 mb-4 border-4 border-black">
              <h3 className="text-xl font-black mb-4 uppercase tracking-wider border-b-2 border-white pb-2">SELECTED BUYER{winners.length > 1 ? 'S' : ''}</h3>
              {isPerfectTie ? (
                <p className="text-lg font-bold">PERFECT TIE. EVERYONE HAS EQUAL CLAIM.</p>
              ) : (
                <>
                  {winners.map((winner, i) => (
                    <div key={winner.id} className="mb-3 border-b border-dashed border-white pb-3">
                      <p className="text-3xl font-black mb-2">{winner.name.toUpperCase()}</p>
                      <p className="text-xl font-semibold">OFFER: {formatCurrency(winner.offer, 2, saleCurrency)}</p>
                      <p className={CLS.textXsBlack}>NEED SCORE: {winner.needScore < 0.01 ? winner.needScore.toExponential(4) : winner.needScore.toFixed(2)}%</p>
                    </div>
                  ))}
                </>
              )}
              <p className="text-xs mt-4 border-t-2 border-dashed border-white pt-2">PRODUCT: {productName.toUpperCase() || 'UNNAMED'}</p>
            </div>

            {renderStatsRow([
              { label: 'PRODUCT', value: productName.toUpperCase() || 'N/A' },
              { label: 'AVAILABLE', value: numAvailable },
              { label: 'AVG OFFER', value: formatCurrency(avgOffer, 2, saleCurrency) },
              { label: 'WEIGHTING', value: getWeightingLabel(saleWeighting) }
            ])}

            <DetailToggleButton show={showSaleDetails} onClick={() => setShowSaleDetails(!showSaleDetails)} />

              {showSaleDetails && (
                <div className="animate-fadeIn">
                  <div className="border-t-2 border-dashed border-gray-400 my-6"></div>
                  
                  <div className="mb-6">
                    <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">BUYER DATA</h3>
                    
                    <div className="space-y-3">
                      {rankedBuyers.map((buyer, i) => {
                        const isWinner = i < numAvailable;
                        return (
                          <div key={buyer.id || i} className={`p-4 border-2 ${isWinner ? 'border-black bg-gray-100' : 'border-gray-400 bg-white'}`}>
                            <div className={`flex justify-between items-start mb-3 border-b ${CLS.borderDashedGray} pb-2`}>
                              <p className={`font-bold text-sm text-black uppercase`}>#{i + 1} {buyer.name}</p>
                              <span className={`px-2 py-1 ${CLS.textXsBlack} font-bold border ${isWinner ? 'bg-black text-white border-black' : 'bg-white text-black border-black'}`}>
                                {isWinner ? 'SELECTED' : 'NOT SELECTED'}
                              </span>
                            </div>
                            <div className={`space-y-2 ${CLS.textXsBlack}`}>
                              <div className="flex justify-between">
                                <span className={CLS.textBlackFontBold}>WEALTH:</span>
                                <span className="font-semibold text-black">{formatCurrency(buyer.wealth, 2, saleCurrency)}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className={CLS.textBlackFontBold}>OFFER:</span>
                                <span className="font-semibold text-black">{formatCurrency(buyer.offer, 2, saleCurrency)}</span>
                              </div>
                              <div className={`flex justify-between pt-2 border-t ${CLS.borderDashedGray}`}>
                                <span className={CLS.textBlackFontBold}>NEED SCORE:</span>
                                <span className="font-black text-black">{buyer.needScore < 0.01 ? buyer.needScore.toExponential(4) : buyer.needScore.toFixed(2)}%</span>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  <div className="border-t-2 border-dashed border-gray-400 my-6"></div>

                  {renderBarVisualization(
                    'NEED SCORE VISUALIZATION',
                    rankedBuyers,
                    [
                      {
                        getValue: (b) => b.needScore,
                        displayValue: (b) => `${b.needScore < 0.01 ? b.needScore.toExponential(2) : b.needScore.toFixed(1)}%`,
                        rightLabel: (b, idx) => `#${idx + 1}`
                      }
                    ],
                    (b) => b.name
                  )}
                </div>
              )}
            </>
          )}

        {renderResultsFooter(
          hasData,
          `Comrade | Selling results\n\nProduct: ${productName || 'Unnamed product'}\nQuantity: ${numAvailable}\n\nSelected buyer${winners.length > 1 ? 's' : ''}:\n${winners.map(w => `${w.name} - ${formatCurrency(w.offer, 2, saleCurrency)}`).join('\n')}\n\nAll buyers ranked by need:\n${rankedBuyers.map((b, i) => `${i + 1}. ${b.name} - Offer: ${formatCurrency(b.offer, 2, saleCurrency)}, need score: ${b.needScore < 0.01 ? b.needScore.toExponential(4) : b.needScore.toFixed(4)}%`).join('\n')}\n\nCalculated using www.comrade.money — the fairer way to sell things.`,
          'sale-entry'
        )}
      </Layout>
    );
  }

  if (page === 'vote-entry') {
    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        <EntryPageWrapper
          title="VOTING"
          description="Make group decisions more equitably. If your friends, classmates, or coworkers are grappling with a dispute, give more voting power to those with less wealth."
          type="vote"
          settingsComponent={renderSettingsPanel(voteWeighting, setVoteWeighting, showVoteSettings, setShowVoteSettings, 'vote-results', voteCurrency, setVoteCurrency, voteWealthMetric, setVoteWealthMetric, undefined, undefined)}
        >
          {/* Box 2: Decision, Options, and Participants */}
          <div className="bg-white p-8 border-2 border-dashed border-gray-400 mb-4">
          <div className="mb-6">
            <div className="flex items-center gap-2 mb-4">
              <svg width="20" height="20" viewBox="0 0 24 24">
                <text x="6" y="19" font-family="monospace" font-size="20" fill="#000" font-weight="bold">?</text>
              </svg>
              <h3 className="text-lg font-bold text-black uppercase tracking-wider">DECISION</h3>
            </div>
            <p className="text-xs mb-3 text-black">Enter the question the group is voting on.</p>
            <FormInput
              type="textarea"
              value={voteDecision}
              onChange={(e) => setVoteDecision(e.target.value)}
              placeholder="DECISION TO BE MADE"
              rows={3}
            />
          </div>

          <div className="border-t-2 border-dashed border-gray-400 my-6"></div>

          <div className="mb-6">
            <div className="flex items-center gap-2 mb-4">
              <ListIcon />
              <h3 className="text-lg font-bold text-black uppercase tracking-wider">OPTIONS</h3>
            </div>
            <p className="text-xs mb-3 text-black">Add all the possible choices people can vote for.</p>
            
            <AddItemCard
              title=""
              containerClassName=""
              fields={[
              {
                value: currentOptionText,
                onChange: (e) => setCurrentOptionText(e.target.value),
                placeholder: "OPTION TEXT",
                minWidth: '200px'
              }
            ]}
            onAdd={() => {
              if (currentOptionText.trim()) {
                setVoteOptions([...voteOptions, {
                  id: Date.now(),
                  text: currentOptionText
                }]);
                setCurrentOptionText('');
              }
            }}
            items={voteOptions}
            onDelete={(id) => setVoteOptions(voteOptions.filter(o => o.id !== id))}
            renderItem={(option) => (
              <p className="font-bold text-xs text-black uppercase">{option.text}</p>
            )}
            addButtonLabel="+ ADD OPTION"
            />
          </div>

          <div className="border-t-2 border-dashed border-gray-400 my-6"></div>

          <div>
            <div className="flex items-center gap-2 mb-4">
              <PersonIcon />
              <h3 className="text-lg font-bold text-black uppercase tracking-wider">PEOPLE</h3>
            </div>
            <p className="text-xs mb-3 text-black">List the people in the group, their financial resources, and how they chose to vote.</p>
            
            <AddItemCard
              title=""
              containerClassName=""
              fields={[
              {
                value: currentParticipantName,
                onChange: (e) => setCurrentParticipantName(e.target.value),
                placeholder: "NAME",
                minWidth: '120px'
              },
              {
                value: currentParticipantWealth,
                onChange: (e) => setCurrentParticipantWealth(e.target.value),
                placeholder: `${getCurrencySymbol(voteCurrency)} ${getWealthMetricLabel(voteWealthMetric).toUpperCase()}`,
                type: 'number',
                min: '0',
                step: '0.01',
                inputMode: 'decimal',
                minWidth: '150px'
              },
              {
                type: 'select',
                value: currentParticipantVote,
                onChange: (e) => setCurrentParticipantVote(e.target.value),
                placeholder: "VOTE",
                options: voteOptions.map(o => o.text),
                minWidth: '120px'
              }
            ]}
            onAdd={() => {
              if (currentParticipantName.trim()) {
                setVoteParticipants([...voteParticipants, {
                  id: Date.now(),
                  name: currentParticipantName,
                  wealth: currentParticipantWealth,
                  vote: currentParticipantVote
                }]);
                setCurrentParticipantName('');
                setCurrentParticipantWealth('');
                setCurrentParticipantVote('');
              }
            }}
            items={voteParticipants}
            onDelete={(id) => setVoteParticipants(voteParticipants.filter(p => p.id !== id))}
            renderItem={(participant) => (
              <>
                <p className={`${CLS.textXsBlack} ${CLS.fontBoldBlackUpper}`}>{participant.name}</p>
                <p className={CLS.textXsBlack}>{getWealthMetricLabel(voteWealthMetric)}: {formatCurrency(participant.wealth, 2, voteCurrency)}</p>
                <p className={CLS.textXsBlack}>Vote: {participant.vote || 'Not selected'}</p>
              </>
            )}
            addButtonLabel="+ ADD PARTICIPANT"
            />
          </div>
        </div>

        </EntryPageWrapper>
      </Layout>
    );
  }

  if (page === 'vote-results') {
    const { participantsData, totalVotingPower, voteBreakdown, options } = voteCalculations;
    const hasData = voteParticipants.length > 0 && voteDecision.trim() && voteOptions.length > 0;
    const winner = voteBreakdown.length > 0 ? voteBreakdown[0] : null;
    const isTie = hasData && voteBreakdown.length > 1 && voteBreakdown[0].percentage === voteBreakdown[1].percentage;

    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        <h2 className="text-2xl font-black mb-6 text-black uppercase tracking-wider border-b-4 border-black pb-2">VOTING RESULTS</h2>
        
        {!hasData && renderNoDataState('vote-entry')}

        {hasData && (
          <>
            <div className="bg-black text-white p-8 mb-4 border-4 border-black">
              <h3 className="text-xl font-black mb-4 uppercase tracking-wider border-b-2 border-white pb-2">DECISION</h3>
              <p className="text-lg mb-6 font-semibold">{voteDecision.toUpperCase()}</p>
              
              {isTie ? (
                <p className="text-xl font-bold">PERFECT TIE. NO CLEAR WINNER.</p>
              ) : winner ? (
                <>
                  <p className="text-sm mb-2">WINNING OPTION:</p>
                  <p className="text-3xl font-black mb-2">{winner.option.toUpperCase()}</p>
                  <p className="text-xl font-semibold">{winner.percentage.toFixed(1)}% OF VOTING POWER</p>
                </>
              ) : (
                <p className="text-lg font-bold">NO VOTES CAST</p>
              )}
              
              <p className="text-xs mt-4 border-t-2 border-dashed border-white pt-2">
                {voteParticipants.length} PARTICIPANT{voteParticipants.length !== 1 ? 'S' : ''}
              </p>
            </div>

            {renderStatsRow([
              { label: 'PARTICIPANTS', value: voteParticipants.length },
              { label: 'OPTIONS', value: options.length },
              { label: 'WEIGHTING', value: getWeightingLabel(voteWeighting) }
            ])}

            <DetailToggleButton show={showVoteDetails} onClick={() => setShowVoteDetails(!showVoteDetails)} />

              {showVoteDetails && (
                <div className="animate-fadeIn">
                  <div className="border-t-2 border-dashed border-gray-400 my-6"></div>
                  
                  <div className="mb-6">
                    <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">VOTE BREAKDOWN</h3>
                    
                    <div className="space-y-4">
                      {voteBreakdown.map((item, i) => (
                        <div key={i} className="border-2 border-gray-400 p-4">
                          <div className="flex justify-between items-start mb-3 border-b border-dashed border-gray-400 pb-2">
                            <p className="font-bold text-sm text-black uppercase">#{i + 1} {item.option}</p>
                            <span className="px-2 py-1 text-xs font-bold bg-black text-white border border-black">
                              {item.percentage.toFixed(1)}%
                            </span>
                          </div>
                          <p className="text-xs text-black mb-2 font-bold">VOTERS ({item.voters.length}):</p>
                          <div className="space-y-1">
                            {item.voters.map(v => (
                              <p key={v.name} className="text-xs text-black">• {v.name} (Power: {v.votingPower.toFixed(2)})</p>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="border-t-2 border-dashed border-gray-400 my-6"></div>

                  <div className="mb-6">
                    <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">PARTICIPANT DATA</h3>
                    
                    <div className="space-y-3">
                      {[...participantsData].sort((a, b) => b.wealth - a.wealth).map((p, idx) => (
                        <div key={p.id || idx} className={CLS.bgWhiteP4Border2}>
                          <p className={`font-bold text-sm text-black mb-3 uppercase ${CLS.borderDashedGray} pb-2`}>
                            {p.name}
                          </p>
                          <div className={`space-y-2 ${CLS.textXsBlack}`}>
                            <div className="flex justify-between">
                              <span className={CLS.textBlackFontBold}>WEALTH:</span>
                              <span className="font-semibold text-black">{formatCurrency(p.wealth, 2, voteCurrency)}</span>
                            </div>
                            <div className="flex justify-between">
                              <span className={CLS.textBlackFontBold}>VOTE:</span>
                              <span className="font-semibold text-black">{p.vote || 'NO VOTE'}</span>
                            </div>
                            <div className={`flex justify-between pt-2 border-t ${CLS.borderDashedGray}`}>
                              <span className={CLS.textBlackFontBold}>VOTING POWER:</span>
                              <span className="font-black text-black">{p.votingPower.toFixed(2)}</span>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="border-t-2 border-dashed border-gray-400 my-6"></div>

                  <div className="mb-6">
                    <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">VOTE DISTRIBUTION</h3>
                    <div className="space-y-3">
                      {(() => {
                        // Calculate unweighted percentages
                        const unweightedVotes = options.map(option => {
                          const voters = participantsData.filter(p => p.vote === option);
                          const percentage = participantsData.length > 0 ? (voters.length / participantsData.length) * 100 : 0;
                          return { option, percentage, voters };
                        });
                        
                        // Sort by weighted percentage (descending)
                        const sortedBreakdown = [...voteBreakdown];
                        
                        return sortedBreakdown.map((item, idx) => {
                          const unweighted = unweightedVotes.find(u => u.option === item.option);
                          const unweightedPct = unweighted ? unweighted.percentage : 0;
                          const maxPct = Math.max(...sortedBreakdown.map(b => b.percentage));
                          const weightedWidth = maxPct > 0 ? (item.percentage / maxPct) * 100 : 0;
                          const unweightedWidth = maxPct > 0 ? (unweightedPct / maxPct) * 100 : 0;
                          
                          return (
                            <div key={idx} className="mb-4">
                              <p className="font-bold text-black mb-1 text-xs uppercase">{item.option}</p>
                              <div className="space-y-1">
                                <div className="flex items-center gap-2">
                                  <span className="text-xs text-black w-24 font-bold">WEIGHTED:</span>
                                  <div className="flex-1 bg-gray-200 h-6 relative overflow-hidden border border-gray-400">
                                    <div 
                                      className="h-6 transition-all duration-300 bar-animate flex items-center justify-end pr-2 bg-black"
                                      style={{
                                        width: `${weightedWidth}%`,
                                        animationDelay: `${idx * 0.1}s`
                                      }}
                                    >
                                      {weightedWidth > 15 && <span className="text-xs font-bold text-white">{item.percentage.toFixed(1)}%</span>}
                                    </div>
                                  </div>
                                  <span className="text-xs font-bold text-black w-16 text-right">{item.percentage.toFixed(1)}%</span>
                                </div>
                                <div className="flex items-center gap-2">
                                  <span className="text-xs text-black w-24 font-bold">UNWEIGHTED:</span>
                                  <div className="flex-1 bg-gray-200 h-6 relative overflow-hidden border border-gray-400">
                                    <div 
                                      className="h-6 transition-all duration-300 bar-animate flex items-center justify-end pr-2 bg-black"
                                      style={{
                                        width: `${unweightedWidth}%`,
                                        animationDelay: `${idx * 0.1 + 0.05}s`
                                      }}
                                    >
                                      {unweightedWidth > 15 && <span className="text-xs font-bold text-white">{unweightedPct.toFixed(1)}%</span>}
                                    </div>
                                  </div>
                                  <span className="text-xs font-bold text-black w-16 text-right">{unweightedPct.toFixed(1)}%</span>
                                </div>
                              </div>
                            </div>
                          );
                        });
                      })()}
                    </div>
                  </div>

                  <div className="border-t-2 border-dashed border-gray-400 my-6"></div>

                  <div className="mb-6">
                    <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">WEALTH VISUALIZATION</h3>
                    {renderWealthPieChart(participantsData, formatNumber)}
                  </div>
                </div>
              )}
            </>
          )}

        {renderResultsFooter(
          hasData,
          `Comrade | Voting results\n\nDecision: ${voteDecision}\n\nWinner: ${winner ? `${winner.option} (${winner.percentage.toFixed(1)}%)` : 'None'}\n\nBreakdown:\n${voteBreakdown.map((b, i) => `${i + 1}. ${b.option}: ${b.percentage.toFixed(1)}% (${b.voters.length} voter${b.voters.length !== 1 ? 's' : ''})`).join('\n')}\n\nCalculated using www.comrade.money — the fairer way to decide things.`,
          'vote-entry'
        )}
      </Layout>
    );
  }

  if (page === 'rent-entry') {
    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        <EntryPageWrapper
          title="RENT SPLITTING"
          description="Figuring out rent splits with roommates can be a fraught process. Decide it more fairly by accounting for both room size and tenants' financial resources. Larger rooms and higher earners both pay more."
          type="rent"
          settingsComponent={renderSettingsPanel(rentWeighting, setRentWeighting, showRentSettings, setShowRentSettings, 'rent-results', rentCurrency, setRentCurrency, rentWealthMetric, setRentWealthMetric, rentMeasurement, setRentMeasurement)}
        >
          {/* Box 2: Total Costs and Roommates */}
          <div className="bg-white p-8 border-2 border-dashed border-gray-400 mb-4">
          <div className="mb-6">
            <div className="flex items-center gap-2 mb-4">
              <svg width="20" height="20" viewBox="0 0 24 24">
                <path d="M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z" fill="#000"/>
              </svg>
              <h3 className="text-lg font-bold text-black uppercase tracking-wider">TOTAL RENTAL COSTS</h3>
            </div>
            <p className="text-xs mb-3 text-black">List your total monthly rent, and monthly utility costs.</p>
            <FormInput
              type="number"
              value={totalRent}
              onChange={(e) => setTotalRent(e.target.value)}
              placeholder={`${getCurrencySymbol(rentCurrency)} MONTHLY RENT`}
              min="0"
              step="0.01"
              inputMode="decimal"
              className="mb-3"
            />
            <FormInput
              type="number"
              value={totalUtilities}
              onChange={(e) => setTotalUtilities(e.target.value)}
              placeholder={`${getCurrencySymbol(rentCurrency)} MONTHLY UTILITIES`}
              min="0"
              step="0.01"
              inputMode="decimal"
            />
          </div>

          <div className="border-t-2 border-dashed border-gray-400 my-6"></div>

          <div>
            <div className="flex items-center gap-2 mb-4">
              <PersonIcon />
              <h3 className="text-lg font-bold text-black uppercase tracking-wider">TENANTS</h3>
            </div>
            <p className="text-xs mb-3 text-black">Add the names and details of each person sharing the property.</p>
            
            <AddItemCard
              title=""
              containerClassName=""
              fields={[
              {
                value: currentRoommateName,
                onChange: (e) => setCurrentRoommateName(e.target.value),
                placeholder: "NAME",
                minWidth: '120px'
              },
              {
                value: currentRoommateRoomSize,
                onChange: (e) => setCurrentRoommateRoomSize(e.target.value),
                placeholder: `ROOM SIZE (${getMeasurementLabel(rentMeasurement).toUpperCase()})`,
                type: 'number',
                min: '0',
                step: '0.01',
                inputMode: 'decimal',
                minWidth: '150px'
              },
              {
                value: currentRoommateWealth,
                onChange: (e) => setCurrentRoommateWealth(e.target.value),
                placeholder: `${getCurrencySymbol(rentCurrency)} ${getWealthMetricLabel(rentWealthMetric).toUpperCase()}`,
                type: 'number',
                min: '0',
                step: '0.01',
                inputMode: 'decimal',
                minWidth: '180px'
              }
            ]}
            onAdd={() => {
              if (currentRoommateName.trim()) {
                setRentPeople([...rentPeople, {
                  id: Date.now(),
                  name: currentRoommateName,
                  roomSize: currentRoommateRoomSize,
                  wealth: currentRoommateWealth
                }]);
                setCurrentRoommateName('');
                setCurrentRoommateRoomSize('');
                setCurrentRoommateWealth('');
              }
            }}
            items={rentPeople}
            onDelete={(id) => setRentPeople(rentPeople.filter(p => p.id !== id))}
            renderItem={(person) => (
              <>
                <p className={`${CLS.textXsBlack} ${CLS.fontBoldBlackUpper}`}>{person.name}</p>
                <p className={CLS.textXsBlack}>Room: {formatNumber((parseFloat(person.roomSize) || 0).toFixed(0))} {getMeasurementLabel(rentMeasurement).toLowerCase()}</p>
                <p className={CLS.textXsBlack}>{getWealthMetricLabel(rentWealthMetric)}: {formatCurrency(person.wealth, 2, rentCurrency)}</p>
              </>
            )}
            addButtonLabel="+ ADD ROOMMATE"
            />
          </div>
        </div>

        </EntryPageWrapper>
      </Layout>
    );
  }

  if (page === 'rent-results') {
    const { rentAmount, utilitiesAmount, total, totalRoomSize, rentData, avgRent, totalRoomValue } = rentCalculations;
    const hasData = rentPeople.length > 0 && parseFloat(totalRent) > 0;

    return (
      <Layout onNavigate={navigateTo} showCopyToast={showCopyToast}>
        <h2 className="text-2xl font-black mb-6 text-black uppercase tracking-wider border-b-4 border-black pb-2">RENT SPLITTING RESULTS</h2>
        
        {!hasData && renderNoDataState('rent-entry')}

        {hasData && (
          <>
            <div className="bg-black text-white p-8 mb-4 border-4 border-black">
              <h3 className="text-xl font-black mb-4 uppercase tracking-wider border-b-2 border-white pb-2">MONTHLY PAYMENTS</h3>
              <div className="space-y-3">
                {rentData.map((person) => (
                  <div key={person.id} className="border-b border-dashed border-white pb-2">
                    <p className="text-lg font-semibold">{person.name.toUpperCase()}</p>
                    <p className="text-3xl font-black">{formatCurrencySmart(person.fairRent, rentCurrency)}</p>
                    <p className={CLS.textXsBlack}>{person.rentPct.toFixed(1)}% of total</p>
                  </div>
                ))}
              </div>
              <p className={`${CLS.textXsBlack} mt-4 border-t-2 border-dashed border-white pt-2`}>
                TOTAL: {formatCurrency(total, 2, rentCurrency)}/MONTH
              </p>
            </div>

            {renderStatsRow([
              { label: 'RENT', value: formatCurrency(rentAmount, 2, rentCurrency) },
              { label: 'UTILITIES', value: formatCurrency(utilitiesAmount, 2, rentCurrency) },
              { label: 'TENANTS', value: rentPeople.length },
              { label: 'WEIGHTING', value: getWeightingLabel(rentWeighting) }
            ])}

            <DetailToggleButton show={showRentDetails} onClick={() => setShowRentDetails(!showRentDetails)} />

              {showRentDetails && (
                <div className="animate-fadeIn">
                  <div className="border-t-2 border-dashed border-gray-400 my-6"></div>
                  
                  <div className="mb-6">
                    <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">ROOMMATE DATA</h3>
                    
                    <div className="space-y-3">
                      {rentData.map((p, idx) => (
                        <div key={p.id || idx} className={CLS.bgWhiteP4Border2}>
                          <p className={`font-bold text-sm text-black mb-3 uppercase ${CLS.borderDashedGray} pb-2`}>
                            {p.name}
                          </p>
                          <div className={`space-y-2 ${CLS.textXsBlack}`}>
                            <div className="flex justify-between">
                              <span className={CLS.textBlackFontBold}>ROOM SIZE:</span>
                              <span className="font-semibold text-black">{formatNumber(p.roomSize.toFixed(0))} {getMeasurementLabel(rentMeasurement).toLowerCase()}</span>
                            </div>
                            <div className="flex justify-between">
                              <span className={CLS.textBlackFontBold}>WEALTH:</span>
                              <span className="font-semibold text-black">{formatCurrency(p.wealth, 2, rentCurrency)}</span>
                            </div>
                            <div className={`flex justify-between pt-2 border-t ${CLS.borderDashedGray}`}>
                              <span className={CLS.textBlackFontBold}>MONTHLY RENT:</span>
                              <span className="font-black text-black">{formatCurrencySmart(p.fairRent, rentCurrency)}</span>
                            </div>
                            <div className="flex justify-between">
                              <span className={CLS.textBlackFontBold}>% OF TOTAL:</span>
                              <span className="font-black text-black">{p.rentPct.toFixed(1)}%</span>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="border-t-2 border-dashed border-gray-400 my-6"></div>

                  <div className="mb-6">
                    <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">RENT AND ROOM SIZE BREAKDOWN</h3>
                    <div className="space-y-3">
                      {rentData.map((p, idx) => {
                        const maxRent = Math.max(...rentData.map(d => d.fairRent));
                        const rentWidth = maxRent > 0 ? (p.fairRent / maxRent) * 100 : 0;
                        const roomWidth = totalRoomSize > 0 ? (p.roomSize / totalRoomSize) * 100 : 0;
                        
                        return (
                          <div key={p.id || idx} className="mb-4">
                            <p className="font-bold text-black mb-1 text-xs uppercase">{p.name}</p>
                            <div className="space-y-1">
                              <div className="flex items-center gap-2">
                                <span className={`${CLS.textXsBlack} w-20 ${CLS.textBlackFontBold}`}>RENT:</span>
                                <div className="flex-1 bg-gray-200 h-6 relative overflow-hidden border border-gray-400">
                                  <div 
                                    className="h-6 transition-all duration-300 bar-animate flex items-center justify-end pr-2 bg-black"
                                    style={{
                                      width: `${rentWidth}%`,
                                      animationDelay: `${idx * 0.1}s`
                                    }}
                                  >
                                    {rentWidth > 15 && <span className={`${CLS.textXsBlack} font-bold text-white`}>{p.rentPct.toFixed(0)}%</span>}
                                  </div>
                                </div>
                                <span className={`${CLS.textXsBlack} ${CLS.textBlackFontBold} w-24 text-right`}>{formatCurrencySmart(p.fairRent, rentCurrency)}</span>
                              </div>
                              <div className="flex items-center gap-2">
                                <span className={`${CLS.textXsBlack} w-20 ${CLS.textBlackFontBold}`}>ROOM:</span>
                                <div className="flex-1 bg-gray-200 h-6 relative overflow-hidden border border-gray-400">
                                  <div 
                                    className="h-6 transition-all duration-300 bar-animate flex items-center justify-end pr-2 bg-black"
                                    style={{
                                      width: `${roomWidth}%`,
                                      animationDelay: `${idx * 0.1 + 0.05}s`
                                    }}
                                  >
                                    {roomWidth > 15 && <span className={`${CLS.textXsBlack} font-bold text-white`}>{p.roomPct.toFixed(0)}%</span>}
                                  </div>
                                </div>
                                                                  <span className={`${CLS.textXsBlack} ${CLS.textBlackFontBold} w-24 text-right`}>{formatNumber(p.roomSize.toFixed(0))} {getMeasurementLabel(rentMeasurement).toLowerCase()}</span>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  <div className="border-t-2 border-dashed border-gray-400 my-6"></div>

                  <div className="mb-6">
                    <h3 className="text-lg font-bold mb-4 text-black uppercase tracking-wider">WEALTH VISUALIZATION</h3>
                    {renderWealthPieChart(rentData, formatNumber)}
                  </div>
                </div>
              )}
            </>
          )}

        {renderResultsFooter(
          hasData,
          `Comrade | Rent-splitting results\n\nTotal: ${formatCurrency(total, 2, rentCurrency)}/month\nRent: ${formatCurrency(rentAmount, 2, rentCurrency)}\nUtilities: ${formatCurrency(utilitiesAmount, 2, rentCurrency)}\n\nBreakdown:\n${rentData.map(p => `${p.name}: ${formatCurrencySmart(p.fairRent, rentCurrency)} (${p.rentPct.toFixed(1)}%) - ${formatNumber(p.roomSize.toFixed(0))} ${getMeasurementLabel(rentMeasurement).toLowerCase()}`).join('\n')}\n\nCalculated using www.comrade.money — the fairer way to split costs with friends.`,
          'rent-entry'
        )}
      </Layout>
    );
  }
  
  

  return null;
};




// Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Comrade />);
    </script>
</body>
</html>
